/*! For license information please see 902.js.LICENSE.txt */
(self.webpackChunkgallery=self.webpackChunkgallery||[]).push([[902],{4395:(e,t,s)=>{"use strict";s.d(t,{AO:()=>o,Ab:()=>ut,BQ:()=>qe,_f:()=>f,q3:()=>dn,uT:()=>L,xu:()=>C});class n{constructor(e){void 0===e&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){void 0===e&&(e=new o);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){void 0===t&&(t=new o);const s=this.elements,n=e.x,i=e.y,r=e.z;return t.x=s[0]*n+s[1]*i+s[2]*r,t.y=s[3]*n+s[4]*i+s[5]*r,t.z=s[6]*n+s[7]*i+s[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){void 0===t&&(t=new n);const s=this.elements,i=e.elements,o=t.elements,r=s[0],a=s[1],l=s[2],c=s[3],h=s[4],u=s[5],d=s[6],p=s[7],f=s[8],m=i[0],y=i[1],v=i[2],g=i[3],w=i[4],x=i[5],b=i[6],A=i[7],E=i[8];return o[0]=r*m+a*g+l*b,o[1]=r*y+a*w+l*A,o[2]=r*v+a*x+l*E,o[3]=c*m+h*g+u*b,o[4]=c*y+h*w+u*A,o[5]=c*v+h*x+u*E,o[6]=d*m+p*g+f*b,o[7]=d*y+p*w+f*A,o[8]=d*v+p*x+f*E,t}scale(e,t){void 0===t&&(t=new n);const s=this.elements,i=t.elements;for(let t=0;3!==t;t++)i[3*t+0]=e.x*s[3*t+0],i[3*t+1]=e.y*s[3*t+1],i[3*t+2]=e.z*s[3*t+2];return t}solve(e,t){void 0===t&&(t=new o);const s=[];let n,i;for(n=0;n<12;n++)s.push(0);for(n=0;n<3;n++)for(i=0;i<3;i++)s[n+4*i]=this.elements[n+3*i];s[3]=e.x,s[7]=e.y,s[11]=e.z;let r=3;const a=r;let l;let c;do{if(n=a-r,0===s[n+4*n])for(i=n+1;i<a;i++)if(0!==s[n+4*i]){l=4;do{c=4-l,s[c+4*n]+=s[c+4*i]}while(--l);break}if(0!==s[n+4*n])for(i=n+1;i<a;i++){const e=s[n+4*i]/s[n+4*n];l=4;do{c=4-l,s[c+4*i]=c<=n?0:s[c+4*i]-s[c+4*n]*e}while(--l)}}while(--r);if(t.z=s[11]/s[10],t.y=(s[7]-s[6]*t.z)/s[5],t.x=(s[3]-s[2]*t.z-s[1]*t.y)/s[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=[".concat(t.toString(),"], b=[").concat(e.toString(),"], A=[").concat(this.toString(),"]");return t}e(e,t,s){if(void 0===s)return this.elements[t+3*e];this.elements[t+3*e]=s}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){void 0===e&&(e=new n);const t=i;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)t[s+6*o]=this.elements[s+3*o];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let r=3;const a=r;let l;let c;do{if(s=a-r,0===t[s+6*s])for(o=s+1;o<a;o++)if(0!==t[s+6*o]){l=6;do{c=6-l,t[c+6*s]+=t[c+6*o]}while(--l);break}if(0!==t[s+6*s])for(o=s+1;o<a;o++){const e=t[s+6*o]/t[s+6*s];l=6;do{c=6-l,t[c+6*o]=c<=s?0:t[c+6*o]-t[c+6*s]*e}while(--l)}}while(--r);s=2;do{o=s-1;do{const e=t[s+6*o]/t[s+6*s];l=6;do{c=6-l,t[c+6*o]=t[c+6*o]-t[c+6*s]*e}while(--l)}while(o--)}while(--s);s=2;do{const e=1/t[s+6*s];l=6;do{c=6-l,t[c+6*s]=t[c+6*s]*e}while(--l)}while(s--);s=2;do{o=2;do{if(c=t[3+o+6*s],isNaN(c)||c===1/0)throw"Could not reverse! A=[".concat(this.toString(),"]");e.e(s,o,c)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,s=e.y,n=e.z,i=e.w,o=t+t,r=s+s,a=n+n,l=t*o,c=t*r,h=t*a,u=s*r,d=s*a,p=n*a,f=i*o,m=i*r,y=i*a,v=this.elements;return v[0]=1-(u+p),v[1]=c-y,v[2]=h+m,v[3]=c+y,v[4]=1-(l+p),v[5]=d-f,v[6]=h-m,v[7]=d+f,v[8]=1-(l+u),this}transpose(e){void 0===e&&(e=new n);const t=this.elements,s=e.elements;let i;return s[0]=t[0],s[4]=t[4],s[8]=t[8],i=t[1],s[1]=t[3],s[3]=i,i=t[2],s[2]=t[6],s[6]=i,i=t[5],s[5]=t[7],s[7]=i,e}}const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class o{constructor(e,t,s){void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s=0),this.x=e,this.y=t,this.z=s}cross(e,t){void 0===t&&(t=new o);const s=e.x,n=e.y,i=e.z,r=this.x,a=this.y,l=this.z;return t.x=a*i-l*n,t.y=l*s-r*i,t.z=r*n-a*s,t}set(e,t,s){return this.x=e,this.y=t,this.z=s,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new o(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new o(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new n([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,s=this.z,n=Math.sqrt(e*e+t*t+s*s);if(n>0){const e=1/n;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return n}unit(e){void 0===e&&(e=new o);const t=this.x,s=this.y,n=this.z;let i=Math.sqrt(t*t+s*s+n*n);return i>0?(i=1/i,e.x=t*i,e.y=s*i,e.z=n*i):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,s=this.z;return Math.sqrt(e*e+t*t+s*s)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,s=this.y,n=this.z,i=e.x,o=e.y,r=e.z;return Math.sqrt((i-t)*(i-t)+(o-s)*(o-s)+(r-n)*(r-n))}distanceSquared(e){const t=this.x,s=this.y,n=this.z,i=e.x,o=e.y,r=e.z;return(i-t)*(i-t)+(o-s)*(o-s)+(r-n)*(r-n)}scale(e,t){void 0===t&&(t=new o);const s=this.x,n=this.y,i=this.z;return t.x=e*s,t.y=e*n,t.z=e*i,t}vmul(e,t){return void 0===t&&(t=new o),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,s){return void 0===s&&(s=new o),s.x=this.x+e*t.x,s.y=this.y+e*t.y,s.z=this.z+e*t.z,s}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){return void 0===e&&(e=new o),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const s=this.length();if(s>0){const n=r,i=1/s;n.set(this.x*i,this.y*i,this.z*i);const o=a;Math.abs(n.x)<.9?(o.set(1,0,0),n.cross(o,e)):(o.set(0,1,0),n.cross(o,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return"".concat(this.x,",").concat(this.y,",").concat(this.z)}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,s){const n=this.x,i=this.y,o=this.z;s.x=n+(e.x-n)*t,s.y=i+(e.y-i)*t,s.z=o+(e.z-o)*t}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(l),l.almostEquals(e,t)}clone(){return new o(this.x,this.y,this.z)}}o.ZERO=new o(0,0,0),o.UNIT_X=new o(1,0,0),o.UNIT_Y=new o(0,1,0),o.UNIT_Z=new o(0,0,1);const r=new o,a=new o,l=new o;class c{constructor(e){void 0===e&&(e={}),this.lowerBound=new o,this.upperBound=new o,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,s,n){const i=this.lowerBound,o=this.upperBound,r=s;i.copy(e[0]),r&&r.vmult(i,i),o.copy(i);for(let t=1;t<e.length;t++){let s=e[t];r&&(r.vmult(s,h),s=h),s.x>o.x&&(o.x=s.x),s.x<i.x&&(i.x=s.x),s.y>o.y&&(o.y=s.y),s.y<i.y&&(i.y=s.y),s.z>o.z&&(o.z=s.z),s.z<i.z&&(i.z=s.z)}return t&&(t.vadd(i,i),t.vadd(o,o)),n&&(i.x-=n,i.y-=n,i.z-=n,o.x+=n,o.y+=n,o.z+=n),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new c).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,s=this.upperBound,n=e.lowerBound,i=e.upperBound,o=n.x<=s.x&&s.x<=i.x||t.x<=i.x&&i.x<=s.x,r=n.y<=s.y&&s.y<=i.y||t.y<=i.y&&i.y<=s.y,a=n.z<=s.z&&s.z<=i.z||t.z<=i.z&&i.z<=s.z;return o&&r&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,s=this.upperBound,n=e.lowerBound,i=e.upperBound;return t.x<=n.x&&s.x>=i.x&&t.y<=n.y&&s.y>=i.y&&t.z<=n.z&&s.z>=i.z}getCorners(e,t,s,n,i,o,r,a){const l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),s.set(c.x,c.y,l.z),n.set(l.x,c.y,c.z),i.set(c.x,l.y,c.z),o.set(l.x,c.y,l.z),r.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(e,t){const s=u,n=s[0],i=s[1],o=s[2],r=s[3],a=s[4],l=s[5],c=s[6],h=s[7];this.getCorners(n,i,o,r,a,l,c,h);for(let t=0;8!==t;t++){const n=s[t];e.pointToLocal(n,n)}return t.setFromPoints(s)}toWorldFrame(e,t){const s=u,n=s[0],i=s[1],o=s[2],r=s[3],a=s[4],l=s[5],c=s[6],h=s[7];this.getCorners(n,i,o,r,a,l,c,h);for(let t=0;8!==t;t++){const n=s[t];e.pointToWorld(n,n)}return t.setFromPoints(s)}overlapsRay(e){const{direction:t,from:s}=e,n=1/t.x,i=1/t.y,o=1/t.z,r=(this.lowerBound.x-s.x)*n,a=(this.upperBound.x-s.x)*n,l=(this.lowerBound.y-s.y)*i,c=(this.upperBound.y-s.y)*i,h=(this.lowerBound.z-s.z)*o,u=(this.upperBound.z-s.z)*o,d=Math.max(Math.max(Math.min(r,a),Math.min(l,c)),Math.min(h,u)),p=Math.min(Math.min(Math.max(r,a),Math.max(l,c)),Math.max(h,u));return!(p<0)&&!(d>p)}}const h=new o,u=[new o,new o,new o,new o,new o,new o,new o,new o];class d{constructor(){this.matrix=[]}get(e,t){let{index:s}=e,{index:n}=t;if(n>s){const e=n;n=s,s=e}return this.matrix[(s*(s+1)>>1)+n-1]}set(e,t,s){let{index:n}=e,{index:i}=t;if(i>n){const e=i;i=n,n=e}this.matrix[(n*(n+1)>>1)+i-1]=s?1:0}reset(){for(let e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class p{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const s=this._listeners;return void 0===s[e]&&(s[e]=[]),s[e].includes(t)||s[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;const s=this._listeners;return!(void 0===s[e]||!s[e].includes(t))}hasAnyEventListener(e){if(void 0===this._listeners)return!1;return void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;const s=this._listeners;if(void 0===s[e])return this;const n=s[e].indexOf(t);return-1!==n&&s[e].splice(n,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let s=0,n=t.length;s<n;s++)t[s].call(this,e)}return this}}class f{constructor(e,t,s,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s=0),void 0===n&&(n=1),this.x=e,this.y=t,this.z=s,this.w=n}set(e,t,s,n){return this.x=e,this.y=t,this.z=s,this.w=n,this}toString(){return"".concat(this.x,",").concat(this.y,",").concat(this.z,",").concat(this.w)}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const s=Math.sin(.5*t);return this.x=e.x*s,this.y=e.y*s,this.z=e.z*s,this.w=Math.cos(.5*t),this}toAxisAngle(e){void 0===e&&(e=new o),this.normalize();const t=2*Math.acos(this.w),s=Math.sqrt(1-this.w*this.w);return s<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/s,e.y=this.y/s,e.z=this.z/s),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const t=m,s=y;e.tangents(t,s),this.setFromAxisAngle(t,Math.PI)}else{const s=e.cross(t);this.x=s.x,this.y=s.y,this.z=s.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){void 0===t&&(t=new f);const s=this.x,n=this.y,i=this.z,o=this.w,r=e.x,a=e.y,l=e.z,c=e.w;return t.x=s*c+o*r+n*l-i*a,t.y=n*c+o*a+i*r-s*l,t.z=i*c+o*l+s*a-n*r,t.w=o*c-s*r-n*a-i*l,t}inverse(e){void 0===e&&(e=new f);const t=this.x,s=this.y,n=this.z,i=this.w;this.conjugate(e);const o=1/(t*t+s*s+n*n+i*i);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return void 0===e&&(e=new f),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){void 0===t&&(t=new o);const s=e.x,n=e.y,i=e.z,r=this.x,a=this.y,l=this.z,c=this.w,h=c*s+a*i-l*n,u=c*n+l*s-r*i,d=c*i+r*n-a*s,p=-r*s-a*n-l*i;return t.x=h*c+p*-r+u*-l-d*-a,t.y=u*c+p*-a+d*-r-h*-l,t.z=d*c+p*-l+h*-a-u*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let s,n,i;void 0===t&&(t="YZX");const o=this.x,r=this.y,a=this.z,l=this.w;if("YZX"!==t)throw new Error("Euler order ".concat(t," not supported yet."));{const e=o*r+a*l;if(e>.499&&(s=2*Math.atan2(o,l),n=Math.PI/2,i=0),e<-.499&&(s=-2*Math.atan2(o,l),n=-Math.PI/2,i=0),void 0===s){const t=o*o,c=r*r,h=a*a;s=Math.atan2(2*r*l-2*o*a,1-2*c-2*h),n=Math.asin(2*e),i=Math.atan2(2*o*l-2*r*a,1-2*t-2*h)}}e.y=s,e.z=n,e.x=i}setFromEuler(e,t,s,n){void 0===n&&(n="XYZ");const i=Math.cos(e/2),o=Math.cos(t/2),r=Math.cos(s/2),a=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(s/2);return"XYZ"===n?(this.x=a*o*r+i*l*c,this.y=i*l*r-a*o*c,this.z=i*o*c+a*l*r,this.w=i*o*r-a*l*c):"YXZ"===n?(this.x=a*o*r+i*l*c,this.y=i*l*r-a*o*c,this.z=i*o*c-a*l*r,this.w=i*o*r+a*l*c):"ZXY"===n?(this.x=a*o*r-i*l*c,this.y=i*l*r+a*o*c,this.z=i*o*c+a*l*r,this.w=i*o*r-a*l*c):"ZYX"===n?(this.x=a*o*r-i*l*c,this.y=i*l*r+a*o*c,this.z=i*o*c-a*l*r,this.w=i*o*r+a*l*c):"YZX"===n?(this.x=a*o*r+i*l*c,this.y=i*l*r+a*o*c,this.z=i*o*c-a*l*r,this.w=i*o*r-a*l*c):"XZY"===n&&(this.x=a*o*r-i*l*c,this.y=i*l*r-a*o*c,this.z=i*o*c+a*l*r,this.w=i*o*r+a*l*c),this}clone(){return new f(this.x,this.y,this.z,this.w)}slerp(e,t,s){void 0===s&&(s=new f);const n=this.x,i=this.y,o=this.z,r=this.w;let a,l,c,h,u,d=e.x,p=e.y,m=e.z,y=e.w;return l=n*d+i*p+o*m+r*y,l<0&&(l=-l,d=-d,p=-p,m=-m,y=-y),1-l>1e-6?(a=Math.acos(l),c=Math.sin(a),h=Math.sin((1-t)*a)/c,u=Math.sin(t*a)/c):(h=1-t,u=t),s.x=h*n+u*d,s.y=h*i+u*p,s.z=h*o+u*m,s.w=h*r+u*y,s}integrate(e,t,s,n){void 0===n&&(n=new f);const i=e.x*s.x,o=e.y*s.y,r=e.z*s.z,a=this.x,l=this.y,c=this.z,h=this.w,u=.5*t;return n.x+=u*(i*h+o*c-r*l),n.y+=u*(o*h+r*a-i*c),n.z+=u*(r*h+i*l-o*a),n.w+=u*(-i*a-o*l-r*c),n}}const m=new o,y=new o;class v{constructor(e){void 0===e&&(e={}),this.id=v.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type ".concat(this.type)}volume(){throw"volume() not implemented for shape type ".concat(this.type)}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type ".concat(this.type)}calculateWorldAABB(e,t,s,n){throw"calculateWorldAABB() not implemented for shape type ".concat(this.type)}}v.idCounter=0,v.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class g{constructor(e){void 0===e&&(e={}),this.position=new o,this.quaternion=new f,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return g.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return g.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return void 0===t&&(t=new o),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,s,n){return void 0===n&&(n=new o),s.vsub(e,n),t.conjugate(w),w.vmult(n,n),n}static pointToWorldFrame(e,t,s,n){return void 0===n&&(n=new o),t.vmult(s,n),n.vadd(e,n),n}static vectorToWorldFrame(e,t,s){return void 0===s&&(s=new o),e.vmult(t,s),s}static vectorToLocalFrame(e,t,s,n){return void 0===n&&(n=new o),t.w*=-1,t.vmult(s,n),t.w*=-1,n}}const w=new f;class x extends v{constructor(e){void 0===e&&(e={});const{vertices:t=[],faces:s=[],normals:n=[],axes:i,boundingSphereRadius:o}=e;super({type:v.types.CONVEXPOLYHEDRON}),this.vertices=t,this.faces=s,this.faceNormals=n,0===this.faceNormals.length&&this.computeNormals(),o?this.boundingSphereRadius=o:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=i?i.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,s=this.uniqueEdges;s.length=0;const n=new o;for(let i=0;i!==e.length;i++){const o=e[i],r=o.length;for(let e=0;e!==r;e++){const i=(e+1)%r;t[o[e]].vsub(t[o[i]],n),n.normalize();let a=!1;for(let e=0;e!==s.length;e++)if(s[e].almostEquals(n)||s[e].almostEquals(n)){a=!0;break}a||s.push(n.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex ".concat(this.faces[e][t]," not found!"));const t=this.faceNormals[e]||new o;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const s=this.vertices[this.faces[e][0]];if(t.dot(s)<0)for(let t=0;t<this.faces[e].length;t++);}}getFaceNormal(e,t){const s=this.faces[e],n=this.vertices[s[0]],i=this.vertices[s[1]],o=this.vertices[s[2]];x.computeNormal(n,i,o,t)}static computeNormal(e,t,s,n){const i=new o,r=new o;t.vsub(e,r),s.vsub(t,i),i.cross(r,n),n.isZero()||n.normalize()}clipAgainstHull(e,t,s,n,i,r,a,l,c){const h=new o;let u=-1,d=-Number.MAX_VALUE;for(let e=0;e<s.faces.length;e++){h.copy(s.faceNormals[e]),i.vmult(h,h);const t=h.dot(r);t>d&&(d=t,u=e)}const p=[];for(let e=0;e<s.faces[u].length;e++){const t=s.vertices[s.faces[u][e]],r=new o;r.copy(t),i.vmult(r,r),n.vadd(r,r),p.push(r)}u>=0&&this.clipFaceAgainstHull(r,e,t,p,a,l,c)}findSeparatingAxis(e,t,s,n,i,r,a,l){const c=new o,h=new o,u=new o,d=new o,p=new o,f=new o;let m=Number.MAX_VALUE;const y=this;if(y.uniqueAxes)for(let o=0;o!==y.uniqueAxes.length;o++){s.vmult(y.uniqueAxes[o],c);const a=y.testSepAxis(c,e,t,s,n,i);if(!1===a)return!1;a<m&&(m=a,r.copy(c))}else{const o=a?a.length:y.faces.length;for(let l=0;l<o;l++){const o=a?a[l]:l;c.copy(y.faceNormals[o]),s.vmult(c,c);const h=y.testSepAxis(c,e,t,s,n,i);if(!1===h)return!1;h<m&&(m=h,r.copy(c))}}if(e.uniqueAxes)for(let o=0;o!==e.uniqueAxes.length;o++){i.vmult(e.uniqueAxes[o],h);const a=y.testSepAxis(h,e,t,s,n,i);if(!1===a)return!1;a<m&&(m=a,r.copy(h))}else{const o=l?l.length:e.faces.length;for(let a=0;a<o;a++){const o=l?l[a]:a;h.copy(e.faceNormals[o]),i.vmult(h,h);const c=y.testSepAxis(h,e,t,s,n,i);if(!1===c)return!1;c<m&&(m=c,r.copy(h))}}for(let o=0;o!==y.uniqueEdges.length;o++){s.vmult(y.uniqueEdges[o],d);for(let o=0;o!==e.uniqueEdges.length;o++)if(i.vmult(e.uniqueEdges[o],p),d.cross(p,f),!f.almostZero()){f.normalize();const o=y.testSepAxis(f,e,t,s,n,i);if(!1===o)return!1;o<m&&(m=o,r.copy(f))}}return n.vsub(t,u),u.dot(r)>0&&r.negate(r),!0}testSepAxis(e,t,s,n,i,o){x.project(this,e,s,n,b),x.project(t,e,i,o,A);const r=b[0],a=b[1],l=A[0],c=A[1];if(r<c||l<a)return!1;const h=r-c,u=l-a;return h<u?h:u}calculateLocalInertia(e,t){const s=new o,n=new o;this.computeLocalAABB(n,s);const i=s.x-n.x,r=s.y-n.y,a=s.z-n.z;t.x=1/12*e*(2*r*2*r+2*a*2*a),t.y=1/12*e*(2*i*2*i+2*a*2*a),t.z=1/12*e*(2*r*2*r+2*i*2*i)}getPlaneConstantOfFace(e){const t=this.faces[e],s=this.faceNormals[e],n=this.vertices[t[0]];return-s.dot(n)}clipFaceAgainstHull(e,t,s,n,i,r,a){const l=new o,c=new o,h=new o,u=new o,d=new o,p=new o,f=new o,m=new o,y=this,v=n,g=[];let w=-1,x=Number.MAX_VALUE;for(let t=0;t<y.faces.length;t++){l.copy(y.faceNormals[t]),s.vmult(l,l);const n=l.dot(e);n<x&&(x=n,w=t)}if(w<0)return;const b=y.faces[w];b.connectedFaces=[];for(let e=0;e<y.faces.length;e++)for(let t=0;t<y.faces[e].length;t++)-1!==b.indexOf(y.faces[e][t])&&e!==w&&-1===b.connectedFaces.indexOf(e)&&b.connectedFaces.push(e);const A=b.length;for(let e=0;e<A;e++){const n=y.vertices[b[e]],i=y.vertices[b[(e+1)%A]];n.vsub(i,c),h.copy(c),s.vmult(h,h),t.vadd(h,h),u.copy(this.faceNormals[w]),s.vmult(u,u),t.vadd(u,u),h.cross(u,d),d.negate(d),p.copy(n),s.vmult(p,p),t.vadd(p,p);const o=b.connectedFaces[e];f.copy(this.faceNormals[o]);const r=this.getPlaneConstantOfFace(o);m.copy(f),s.vmult(m,m);const a=r-m.dot(t);for(this.clipFaceAgainstPlane(v,g,m,a);v.length;)v.shift();for(;g.length;)v.push(g.shift())}f.copy(this.faceNormals[w]);const E=this.getPlaneConstantOfFace(w);m.copy(f),s.vmult(m,m);const T=E-m.dot(t);for(let e=0;e<v.length;e++){let t=m.dot(v[e])+T;if(t<=i&&(t=i),t<=r){const s=v[e];if(t<=1e-6){const e={point:s,normal:m,depth:t};a.push(e)}}}}clipFaceAgainstPlane(e,t,s,n){let i,r;const a=e.length;if(a<2)return t;let l=e[e.length-1],c=e[0];i=s.dot(l)+n;for(let h=0;h<a;h++){if(c=e[h],r=s.dot(c)+n,i<0)if(r<0){const e=new o;e.copy(c),t.push(e)}else{const e=new o;l.lerp(c,i/(i-r),e),t.push(e)}else if(r<0){const e=new o;l.lerp(c,i/(i-r),e),t.push(e),t.push(c)}l=c,i=r}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new o);const s=this.vertices,n=this.worldVertices;for(let i=0;i!==this.vertices.length;i++)t.vmult(s[i],n[i]),e.vadd(n[i],n[i]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const s=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let n=0;n<this.vertices.length;n++){const i=s[n];i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y),i.z<e.z?e.z=i.z:i.z>t.z&&(t.z=i.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new o);const s=this.faceNormals,n=this.worldFaceNormals;for(let i=0;i!==t;i++)e.vmult(s[i],n[i]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let s=0;s!==t.length;s++){const n=t[s].lengthSquared();n>e&&(e=n)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,s,n){const i=this.vertices;let r,a,l,c,h,u,d=new o;for(let s=0;s<i.length;s++){d.copy(i[s]),t.vmult(d,d),e.vadd(d,d);const n=d;(void 0===r||n.x<r)&&(r=n.x),(void 0===c||n.x>c)&&(c=n.x),(void 0===a||n.y<a)&&(a=n.y),(void 0===h||n.y>h)&&(h=n.y),(void 0===l||n.z<l)&&(l=n.z),(void 0===u||n.z>u)&&(u=n.z)}s.set(r,a,l),n.set(c,h,u)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){void 0===e&&(e=new o);const t=this.vertices;for(let s=0;s<t.length;s++)e.vadd(t[s],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const s=this.vertices.length,n=this.vertices;if(t){for(let e=0;e<s;e++){const s=n[e];t.vmult(s,s)}for(let e=0;e<this.faceNormals.length;e++){const s=this.faceNormals[e];t.vmult(s,s)}}if(e)for(let t=0;t<s;t++){const s=n[t];s.vadd(e,s)}}pointIsInside(e){const t=this.vertices,s=this.faces,n=this.faceNormals,i=new o;this.getAveragePointLocal(i);for(let r=0;r<this.faces.length;r++){let a=n[r];const l=t[s[r][0]],c=new o;e.vsub(l,c);const h=a.dot(c),u=new o;i.vsub(l,u);const d=a.dot(u);if(h<0&&d>0||h>0&&d<0)return!1}return-1}static project(e,t,s,n,i){const o=e.vertices.length,r=E;let a=0,l=0;const c=T,h=e.vertices;c.setZero(),g.vectorToLocalFrame(s,n,t,r),g.pointToLocalFrame(s,n,c,c);const u=c.dot(r);l=a=h[0].dot(r);for(let e=1;e<o;e++){const t=h[e].dot(r);t>a&&(a=t),t<l&&(l=t)}if(l-=u,a-=u,l>a){const e=l;l=a,a=e}i[0]=a,i[1]=l}}const b=[],A=[],E=(new o,new o),T=new o;class C extends v{constructor(e){super({type:v.types.BOX}),this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,s=this.halfExtents.z,n=o,i=[new n(-e,-t,-s),new n(e,-t,-s),new n(e,t,-s),new n(-e,t,-s),new n(-e,-t,s),new n(e,-t,s),new n(e,t,s),new n(-e,t,s)],r=[new n(0,0,1),new n(0,1,0),new n(1,0,0)],a=new x({vertices:i,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:r});this.convexPolyhedronRepresentation=a,a.material=this.material}calculateLocalInertia(e,t){return void 0===t&&(t=new o),C.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,s){const n=e;s.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),s.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),s.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)}getSideNormals(e,t){const s=e,n=this.halfExtents;if(s[0].set(n.x,0,0),s[1].set(0,n.y,0),s[2].set(0,0,n.z),s[3].set(-n.x,0,0),s[4].set(0,-n.y,0),s[5].set(0,0,-n.z),void 0!==t)for(let e=0;e!==s.length;e++)t.vmult(s[e],s[e]);return s}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,s){const n=this.halfExtents,i=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]];for(let n=0;n<i.length;n++)S.set(i[n][0],i[n][1],i[n][2]),t.vmult(S,S),e.vadd(S,S),s(S.x,S.y,S.z)}calculateWorldAABB(e,t,s,n){const i=this.halfExtents;R[0].set(i.x,i.y,i.z),R[1].set(-i.x,i.y,i.z),R[2].set(-i.x,-i.y,i.z),R[3].set(-i.x,-i.y,-i.z),R[4].set(i.x,-i.y,-i.z),R[5].set(i.x,i.y,-i.z),R[6].set(-i.x,i.y,-i.z),R[7].set(i.x,-i.y,i.z);const o=R[0];t.vmult(o,o),e.vadd(o,o),n.copy(o),s.copy(o);for(let i=1;i<8;i++){const o=R[i];t.vmult(o,o),e.vadd(o,o);const r=o.x,a=o.y,l=o.z;r>n.x&&(n.x=r),a>n.y&&(n.y=a),l>n.z&&(n.z=l),r<s.x&&(s.x=r),a<s.y&&(s.y=a),l<s.z&&(s.z=l)}}}const S=new o,R=[new o,new o,new o,new o,new o,new o,new o,new o],P=1,M=2,I=4,F=0,N=1,B=2;class L extends p{constructor(e){void 0===e&&(e={}),super(),this.id=L.idCounter++,this.index=-1,this.world=null,this.vlambda=new o,this.collisionFilterGroup="number"==typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!=typeof e.collisionResponse||e.collisionResponse,this.position=new o,this.previousPosition=new o,this.interpolatedPosition=new o,this.initPosition=new o,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new o,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new o,this.force=new o;const t="number"==typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"==typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?L.STATIC:L.DYNAMIC,typeof e.type==typeof L.STATIC&&(this.type=e.type),this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.sleepState=L.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new o,this.quaternion=new f,this.initQuaternion=new f,this.previousQuaternion=new f,this.interpolatedQuaternion=new f,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new o,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new o,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new o,this.invInertia=new o,this.invInertiaWorld=new n,this.invMassSolve=0,this.invInertiaSolve=new o,this.invInertiaWorldSolve=new n,this.fixedRotation=void 0!==e.fixedRotation&&e.fixedRotation,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.01,this.linearFactor=new o(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new o(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new c,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new o,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=L.AWAKE,this.wakeUpAfterNarrowphase=!1,e===L.SLEEPING&&this.dispatchEvent(L.wakeupEvent)}sleep(){this.sleepState=L.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,s=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),n=this.sleepSpeedLimit**2;t===L.AWAKE&&s<n?(this.sleepState=L.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(L.sleepyEvent)):t===L.SLEEPY&&s>n?this.wakeUp():t===L.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(L.sleepEvent))}}updateSolveMassProperties(){this.sleepState===L.SLEEPING||this.type===L.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return void 0===t&&(t=new o),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return void 0===t&&(t=new o),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return void 0===t&&(t=new o),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return void 0===t&&(t=new o),this.quaternion.vmult(e,t),t}addShape(e,t,s){const n=new o,i=new f;return t&&n.copy(t),s&&i.copy(s),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(i),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return-1===t||(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null),this}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,s=e.length;let n=0;for(let i=0;i!==s;i++){const s=e[i];s.updateBoundingSphereRadius();const o=t[i].length(),r=s.boundingSphereRadius;o+r>n&&(n=o+r)}this.boundingRadius=n}updateAABB(){const e=this.shapes,t=this.shapeOffsets,s=this.shapeOrientations,n=e.length,i=_,o=z,r=this.quaternion,a=this.aabb,l=O;for(let c=0;c!==n;c++){const n=e[c];r.vmult(t[c],i),i.vadd(this.position,i),r.mult(s[c],o),n.calculateWorldAABB(i,o,l.lowerBound,l.upperBound),0===c?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const e=k,s=j;e.setRotationFromQuaternion(this.quaternion),e.transpose(s),e.scale(t,e),e.mmult(s,this.invInertiaWorld)}else;}applyForce(e,t){if(void 0===t&&(t=new o),this.type!==L.DYNAMIC)return;this.sleepState===L.SLEEPING&&this.wakeUp();const s=q;t.cross(e,s),this.force.vadd(e,this.force),this.torque.vadd(s,this.torque)}applyLocalForce(e,t){if(void 0===t&&(t=new o),this.type!==L.DYNAMIC)return;const s=H,n=D;this.vectorToWorldFrame(e,s),this.vectorToWorldFrame(t,n),this.applyForce(s,n)}applyTorque(e){this.type===L.DYNAMIC&&(this.sleepState===L.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(void 0===t&&(t=new o),this.type!==L.DYNAMIC)return;this.sleepState===L.SLEEPING&&this.wakeUp();const s=t,n=V;n.copy(e),n.scale(this.invMass,n),this.velocity.vadd(n,this.velocity);const i=U;s.cross(e,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}applyLocalImpulse(e,t){if(void 0===t&&(t=new o),this.type!==L.DYNAMIC)return;const s=G,n=W;this.vectorToWorldFrame(e,s),this.vectorToWorldFrame(t,n),this.applyImpulse(s,n)}updateMassProperties(){const e=K;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,s=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),C.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!s?1/t.x:0,t.y>0&&!s?1/t.y:0,t.z>0&&!s?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const s=new o;return e.vsub(this.position,s),this.angularVelocity.cross(s,t),this.velocity.vadd(t,t),t}integrate(e,t,s){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==L.DYNAMIC&&this.type!==L.KINEMATIC||this.sleepState===L.SLEEPING)return;const n=this.velocity,i=this.angularVelocity,o=this.position,r=this.force,a=this.torque,l=this.quaternion,c=this.invMass,h=this.invInertiaWorld,u=this.linearFactor,d=c*e;n.x+=r.x*d*u.x,n.y+=r.y*d*u.y,n.z+=r.z*d*u.z;const p=h.elements,f=this.angularFactor,m=a.x*f.x,y=a.y*f.y,v=a.z*f.z;i.x+=e*(p[0]*m+p[1]*y+p[2]*v),i.y+=e*(p[3]*m+p[4]*y+p[5]*v),i.z+=e*(p[6]*m+p[7]*y+p[8]*v),o.x+=n.x*e,o.y+=n.y*e,o.z+=n.z*e,l.integrate(this.angularVelocity,e,this.angularFactor,l),t&&(s?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}L.idCounter=0,L.COLLIDE_EVENT_NAME="collide",L.DYNAMIC=P,L.STATIC=M,L.KINEMATIC=I,L.AWAKE=F,L.SLEEPY=N,L.SLEEPING=B,L.wakeupEvent={type:"wakeup"},L.sleepyEvent={type:"sleepy"},L.sleepEvent={type:"sleep"};const _=new o,z=new f,O=new c,k=new n,j=new n,q=(new n,new o),H=new o,D=new o,V=new o,U=new o,G=new o,W=new o,K=new o;class X{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,t,s){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,t){return 0!=(e.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&e.collisionFilterMask)&&(0==(e.type&L.STATIC)&&e.sleepState!==L.SLEEPING||0==(t.type&L.STATIC)&&t.sleepState!==L.SLEEPING)}intersectionTest(e,t,s,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,s,n):this.doBoundingSphereBroadphase(e,t,s,n)}doBoundingSphereBroadphase(e,t,s,n){const i=Y;t.position.vsub(e.position,i);const o=(e.boundingRadius+t.boundingRadius)**2;i.lengthSquared()<o&&(s.push(e),n.push(t))}doBoundingBoxBroadphase(e,t,s,n){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(s.push(e),n.push(t))}makePairsUnique(e,t){const s=Z,n=Q,i=J,o=e.length;for(let s=0;s!==o;s++)n[s]=e[s],i[s]=t[s];e.length=0,t.length=0;for(let e=0;e!==o;e++){const t=n[e].id,o=i[e].id,r=t<o?"".concat(t,",").concat(o):"".concat(o,",").concat(t);s[r]=e,s.keys.push(r)}for(let o=0;o!==s.keys.length;o++){const o=s.keys.pop(),r=s[o];e.push(n[r]),t.push(i[r]),delete s[o]}}setWorld(e){}static boundingSphereCheck(e,t){const s=new o;e.position.vsub(t.position,s);const n=e.shapes[0],i=t.shapes[0];return Math.pow(n.boundingSphereRadius+i.boundingSphereRadius,2)>s.lengthSquared()}aabbQuery(e,t,s){return[]}}const Y=new o;new o,new f,new o;const Z={keys:[]},Q=[],J=[];new o;new o;new o;class $ extends X{constructor(){super()}collisionPairs(e,t,s){const n=e.bodies,i=n.length;let o,r;for(let e=0;e!==i;e++)for(let i=0;i!==e;i++)o=n[e],r=n[i],this.needBroadphaseCollision(o,r)&&this.intersectionTest(o,r,t,s)}aabbQuery(e,t,s){void 0===s&&(s=[]);for(let n=0;n<e.bodies.length;n++){const i=e.bodies[n];i.aabbNeedsUpdate&&i.updateAABB(),i.aabb.overlaps(t)&&s.push(i)}return s}}class ee{constructor(){this.rayFromWorld=new o,this.rayToWorld=new o,this.hitNormalWorld=new o,this.hitPointWorld=new o,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,s,n,i,o,r){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(s),this.hitPointWorld.copy(n),this.shape=i,this.body=o,this.distance=r}}let te,se,ne,ie,oe,re,ae;const le=1,ce=2,he=4;te=v.types.SPHERE,se=v.types.PLANE,ne=v.types.BOX,ie=v.types.CYLINDER,oe=v.types.CONVEXPOLYHEDRON,re=v.types.HEIGHTFIELD,ae=v.types.TRIMESH;class ue{get[te](){return this._intersectSphere}get[se](){return this._intersectPlane}get[ne](){return this._intersectBox}get[ie](){return this._intersectConvex}get[oe](){return this._intersectConvex}get[re](){return this._intersectHeightfield}get[ae](){return this._intersectTrimesh}constructor(e,t){void 0===e&&(e=new o),void 0===t&&(t=new o),this.from=e.clone(),this.to=t.clone(),this.direction=new o,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ue.ANY,this.result=new ee,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||ue.ANY,this.result=t.result||new ee,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(de),pe.length=0,e.broadphase.aabbQuery(e,de,pe),this.intersectBodies(pe),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const s=this.checkCollisionResponse;if(s&&!e.collisionResponse)return;if(0==(this.collisionFilterGroup&e.collisionFilterMask)||0==(e.collisionFilterGroup&this.collisionFilterMask))return;const n=ye,i=ve;for(let t=0,o=e.shapes.length;t<o;t++){const o=e.shapes[t];if((!s||o.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[t],i),e.quaternion.vmult(e.shapeOffsets[t],n),n.vadd(e.position,n),this.intersectShape(o,i,n,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let t=0,s=e.length;!this.result.shouldStop&&t<s;t++)this.intersectBody(e[t])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,s,n){const i=function(e,t,s){s.vsub(e,ke);const n=ke.dot(t);t.scale(n,je),je.vadd(e,je);const i=s.distanceTo(je);return i}(this.from,this.direction,s);if(i>e.boundingSphereRadius)return;const o=this[e.type];o&&o.call(this,e,t,s,n,e)}_intersectBox(e,t,s,n,i){return this._intersectConvex(e.convexPolyhedronRepresentation,t,s,n,i)}_intersectPlane(e,t,s,n,i){const r=this.from,a=this.to,l=this.direction,c=new o(0,0,1);t.vmult(c,c);const h=new o;r.vsub(s,h);const u=h.dot(c);a.vsub(s,h);if(u*h.dot(c)>0)return;if(r.distanceTo(a)<u)return;const d=c.dot(l);if(Math.abs(d)<this.precision)return;const p=new o,f=new o,m=new o;r.vsub(s,p);const y=-c.dot(p)/d;l.scale(y,f),r.vadd(f,m),this.reportIntersection(c,m,i,n,-1)}getAABB(e){const{lowerBound:t,upperBound:s}=e,n=this.to,i=this.from;t.x=Math.min(n.x,i.x),t.y=Math.min(n.y,i.y),t.z=Math.min(n.z,i.z),s.x=Math.max(n.x,i.x),s.y=Math.max(n.y,i.y),s.z=Math.max(n.z,i.z)}_intersectHeightfield(e,t,s,n,i){e.data,e.elementSize;const o=Te;o.from.copy(this.from),o.to.copy(this.to),g.pointToLocalFrame(s,t,o.from,o.from),g.pointToLocalFrame(s,t,o.to,o.to),o.updateDirection();const r=Ce;let a,l,h,u;a=l=0,h=u=e.data.length-1;const d=new c;o.getAABB(d),e.getIndexOfPosition(d.lowerBound.x,d.lowerBound.y,r,!0),a=Math.max(a,r[0]),l=Math.max(l,r[1]),e.getIndexOfPosition(d.upperBound.x,d.upperBound.y,r,!0),h=Math.min(h,r[0]+1),u=Math.min(u,r[1]+1);for(let r=a;r<h;r++)for(let a=l;a<u;a++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(r,a,d),d.overlapsRay(o)){if(e.getConvexTrianglePillar(r,a,!1),g.pointToWorldFrame(s,t,e.pillarOffset,Ee),this._intersectConvex(e.pillarConvex,t,Ee,n,i,Ae),this.result.shouldStop)return;e.getConvexTrianglePillar(r,a,!0),g.pointToWorldFrame(s,t,e.pillarOffset,Ee),this._intersectConvex(e.pillarConvex,t,Ee,n,i,Ae)}}}_intersectSphere(e,t,s,n,i){const o=this.from,r=this.to,a=e.radius,l=(r.x-o.x)**2+(r.y-o.y)**2+(r.z-o.z)**2,c=2*((r.x-o.x)*(o.x-s.x)+(r.y-o.y)*(o.y-s.y)+(r.z-o.z)*(o.z-s.z)),h=c**2-4*l*((o.x-s.x)**2+(o.y-s.y)**2+(o.z-s.z)**2-a**2),u=Se,d=Re;if(!(h<0))if(0===h)o.lerp(r,h,u),u.vsub(s,d),d.normalize(),this.reportIntersection(d,u,i,n,-1);else{const e=(-c-Math.sqrt(h))/(2*l),t=(-c+Math.sqrt(h))/(2*l);if(e>=0&&e<=1&&(o.lerp(r,e,u),u.vsub(s,d),d.normalize(),this.reportIntersection(d,u,i,n,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(o.lerp(r,t,u),u.vsub(s,d),d.normalize(),this.reportIntersection(d,u,i,n,-1))}}_intersectConvex(e,t,s,n,i,o){const r=Pe,a=Me,l=o&&o.faceList||null,c=e.faces,h=e.vertices,u=e.faceNormals,d=this.direction,p=this.from,f=this.to,m=p.distanceTo(f),y=l?l.length:c.length,v=this.result;for(let e=0;!v.shouldStop&&e<y;e++){const o=l?l[e]:e,f=c[o],y=u[o],g=t,w=s;a.copy(h[f[0]]),g.vmult(a,a),a.vadd(w,a),a.vsub(p,a),g.vmult(y,r);const x=d.dot(r);if(Math.abs(x)<this.precision)continue;const b=r.dot(a)/x;if(!(b<0)){d.scale(b,ge),ge.vadd(p,ge),we.copy(h[f[0]]),g.vmult(we,we),w.vadd(we,we);for(let e=1;!v.shouldStop&&e<f.length-1;e++){xe.copy(h[f[e]]),be.copy(h[f[e+1]]),g.vmult(xe,xe),g.vmult(be,be),w.vadd(xe,xe),w.vadd(be,be);const t=ge.distanceTo(p);!ue.pointInTriangle(ge,we,xe,be)&&!ue.pointInTriangle(ge,xe,we,be)||t>m||this.reportIntersection(r,ge,i,n,o)}}}}_intersectTrimesh(e,t,s,n,i,o){const r=Ie,a=ze,l=Oe,c=Me,h=Fe,u=Ne,d=Be,p=_e,f=Le,m=e.indices;e.vertices;const y=this.from,v=this.to,w=this.direction;l.position.copy(s),l.quaternion.copy(t),g.vectorToLocalFrame(s,t,w,h),g.pointToLocalFrame(s,t,y,u),g.pointToLocalFrame(s,t,v,d),d.x*=e.scale.x,d.y*=e.scale.y,d.z*=e.scale.z,u.x*=e.scale.x,u.y*=e.scale.y,u.z*=e.scale.z,d.vsub(u,h),h.normalize();const x=u.distanceSquared(d);e.tree.rayQuery(this,l,a);for(let o=0,l=a.length;!this.result.shouldStop&&o!==l;o++){const l=a[o];e.getNormal(l,r),e.getVertex(m[3*l],we),we.vsub(u,c);const d=h.dot(r),y=r.dot(c)/d;if(y<0)continue;h.scale(y,ge),ge.vadd(u,ge),e.getVertex(m[3*l+1],xe),e.getVertex(m[3*l+2],be);const v=ge.distanceSquared(u);!ue.pointInTriangle(ge,xe,we,be)&&!ue.pointInTriangle(ge,we,xe,be)||v>x||(g.vectorToWorldFrame(t,r,f),g.pointToWorldFrame(s,t,ge,p),this.reportIntersection(f,p,i,n,l))}a.length=0}reportIntersection(e,t,s,n,i){const o=this.from,r=this.to,a=o.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=void 0!==i?i:-1,this.mode){case ue.ALL:this.hasHit=!0,l.set(o,r,e,t,s,n,a),l.hasHit=!0,this.callback(l);break;case ue.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(o,r,e,t,s,n,a));break;case ue.ANY:this.hasHit=!0,l.hasHit=!0,l.set(o,r,e,t,s,n,a),l.shouldStop=!0}}static pointInTriangle(e,t,s,n){n.vsub(t,ke),s.vsub(t,fe),e.vsub(t,me);const i=ke.dot(ke),o=ke.dot(fe),r=ke.dot(me),a=fe.dot(fe),l=fe.dot(me);let c,h;return(c=a*r-o*l)>=0&&(h=i*l-o*r)>=0&&c+h<i*a-o*o}}ue.CLOSEST=le,ue.ANY=ce,ue.ALL=he;const de=new c,pe=[],fe=new o,me=new o,ye=new o,ve=new f,ge=new o,we=new o,xe=new o,be=new o;new o,new ee;const Ae={faceList:[0]},Ee=new o,Te=new ue,Ce=[],Se=new o,Re=new o,Pe=new o,Me=(new o,new o,new o),Ie=new o,Fe=new o,Ne=new o,Be=new o,Le=new o,_e=new o;new c;const ze=[],Oe=new g,ke=new o,je=new o;class qe extends X{static checkBounds(e,t,s){let n,i;0===s?(n=e.position.x,i=t.position.x):1===s?(n=e.position.y,i=t.position.y):2===s&&(n=e.position.z,i=t.position.z);const o=e.boundingRadius;return i-t.boundingRadius<n+o}static insertionSortX(e){for(let t=1,s=e.length;t<s;t++){const s=e[t];let n;for(n=t-1;n>=0&&!(e[n].aabb.lowerBound.x<=s.aabb.lowerBound.x);n--)e[n+1]=e[n];e[n+1]=s}return e}static insertionSortY(e){for(let t=1,s=e.length;t<s;t++){const s=e[t];let n;for(n=t-1;n>=0&&!(e[n].aabb.lowerBound.y<=s.aabb.lowerBound.y);n--)e[n+1]=e[n];e[n+1]=s}return e}static insertionSortZ(e){for(let t=1,s=e.length;t<s;t++){const s=e[t];let n;for(n=t-1;n>=0&&!(e[n].aabb.lowerBound.z<=s.aabb.lowerBound.z);n--)e[n+1]=e[n];e[n+1]=s}return e}constructor(e){super(),this.axisList=[],this.world=null,this.axisIndex=0;const t=this.axisList;this._addBodyHandler=e=>{t.push(e.body)},this._removeBodyHandler=e=>{const s=t.indexOf(e.body);-1!==s&&t.splice(s,1)},e&&this.setWorld(e)}setWorld(e){this.axisList.length=0;for(let t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0}collisionPairs(e,t,s){const n=this.axisList,i=n.length,o=this.axisIndex;let r,a;for(this.dirty&&(this.sortList(),this.dirty=!1),r=0;r!==i;r++){const e=n[r];for(a=r+1;a<i;a++){const i=n[a];if(this.needBroadphaseCollision(e,i)){if(!qe.checkBounds(e,i,o))break;this.intersectionTest(e,i,t,s)}}}}sortList(){const e=this.axisList,t=this.axisIndex,s=e.length;for(let t=0;t!==s;t++){const s=e[t];s.aabbNeedsUpdate&&s.updateAABB()}0===t?qe.insertionSortX(e):1===t?qe.insertionSortY(e):2===t&&qe.insertionSortZ(e)}autoDetectAxis(){let e=0,t=0,s=0,n=0,i=0,o=0;const r=this.axisList,a=r.length,l=1/a;for(let l=0;l!==a;l++){const a=r[l],c=a.position.x;e+=c,t+=c*c;const h=a.position.y;s+=h,n+=h*h;const u=a.position.z;i+=u,o+=u*u}const c=t-e*e*l,h=n-s*s*l,u=o-i*i*l;this.axisIndex=c>h?c>u?0:2:h>u?1:2}aabbQuery(e,t,s){void 0===s&&(s=[]),this.dirty&&(this.sortList(),this.dirty=!1);const n=this.axisIndex;let i="x";1===n&&(i="y"),2===n&&(i="z");const o=this.axisList;t.lowerBound[i],t.upperBound[i];for(let e=0;e<o.length;e++){const n=o[e];n.aabbNeedsUpdate&&n.updateAABB(),n.aabb.overlaps(t)&&s.push(n)}return s}}class He{static defaults(e,t){void 0===e&&(e={});for(let s in t)s in e||(e[s]=t[s]);return e}}class De{constructor(e,t,s){void 0===s&&(s={}),s=He.defaults(s,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=e,this.bodyB=t,this.id=De.idCounter++,this.collideConnected=s.collideConnected,s.wakeUpBodies&&(e&&e.wakeUp(),t&&t.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!0}disable(){const e=this.equations;for(let t=0;t<e.length;t++)e[t].enabled=!1}}De.idCounter=0;class Ve{constructor(){this.spatial=new o,this.rotational=new o}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}class Ue{constructor(e,t,s,n){void 0===s&&(s=-1e6),void 0===n&&(n=1e6),this.id=Ue.idCounter++,this.minForce=s,this.maxForce=n,this.bi=e,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Ve,this.jacobianElementB=new Ve,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,t,s){const n=t,i=e,o=s;this.a=4/(o*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(o*o*i*(1+4*n))}computeB(e,t,s){const n=this.computeGW();return-this.computeGq()*e-n*t-this.computeGiMf()*s}computeGq(){const e=this.jacobianElementA,t=this.jacobianElementB,s=this.bi,n=this.bj,i=s.position,o=n.position;return e.spatial.dot(i)+t.spatial.dot(o)}computeGW(){const e=this.jacobianElementA,t=this.jacobianElementB,s=this.bi,n=this.bj,i=s.velocity,o=n.velocity,r=s.angularVelocity,a=n.angularVelocity;return e.multiplyVectors(i,r)+t.multiplyVectors(o,a)}computeGWlambda(){const e=this.jacobianElementA,t=this.jacobianElementB,s=this.bi,n=this.bj,i=s.vlambda,o=n.vlambda,r=s.wlambda,a=n.wlambda;return e.multiplyVectors(i,r)+t.multiplyVectors(o,a)}computeGiMf(){const e=this.jacobianElementA,t=this.jacobianElementB,s=this.bi,n=this.bj,i=s.force,o=s.torque,r=n.force,a=n.torque,l=s.invMassSolve,c=n.invMassSolve;return i.scale(l,Ge),r.scale(c,We),s.invInertiaWorldSolve.vmult(o,Ke),n.invInertiaWorldSolve.vmult(a,Xe),e.multiplyVectors(Ge,Ke)+t.multiplyVectors(We,Xe)}computeGiMGt(){const e=this.jacobianElementA,t=this.jacobianElementB,s=this.bi,n=this.bj,i=s.invMassSolve,o=n.invMassSolve,r=s.invInertiaWorldSolve,a=n.invInertiaWorldSolve;let l=i+o;return r.vmult(e.rotational,Ye),l+=Ye.dot(e.rotational),a.vmult(t.rotational,Ye),l+=Ye.dot(t.rotational),l}addToWlambda(e){const t=this.jacobianElementA,s=this.jacobianElementB,n=this.bi,i=this.bj,o=Ze;n.vlambda.addScaledVector(n.invMassSolve*e,t.spatial,n.vlambda),i.vlambda.addScaledVector(i.invMassSolve*e,s.spatial,i.vlambda),n.invInertiaWorldSolve.vmult(t.rotational,o),n.wlambda.addScaledVector(e,o,n.wlambda),i.invInertiaWorldSolve.vmult(s.rotational,o),i.wlambda.addScaledVector(e,o,i.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Ue.idCounter=0;const Ge=new o,We=new o,Ke=new o,Xe=new o,Ye=new o,Ze=new o;class Qe extends Ue{constructor(e,t,s){void 0===s&&(s=1e6),super(e,t,0,s),this.restitution=0,this.ri=new o,this.rj=new o,this.ni=new o}computeB(e){const t=this.a,s=this.b,n=this.bi,i=this.bj,o=this.ri,r=this.rj,a=Je,l=$e,c=n.velocity,h=n.angularVelocity;n.force,n.torque;const u=i.velocity,d=i.angularVelocity;i.force,i.torque;const p=et,f=this.jacobianElementA,m=this.jacobianElementB,y=this.ni;o.cross(y,a),r.cross(y,l),y.negate(f.spatial),a.negate(f.rotational),m.spatial.copy(y),m.rotational.copy(l),p.copy(i.position),p.vadd(r,p),p.vsub(n.position,p),p.vsub(o,p);const v=y.dot(p),g=this.restitution+1;return-v*t-(g*u.dot(y)-g*c.dot(y)+d.dot(l)-h.dot(a))*s-e*this.computeGiMf()}getImpactVelocityAlongNormal(){const e=tt,t=st,s=nt,n=it,i=ot;return this.bi.position.vadd(this.ri,s),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(s,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,i),this.ni.dot(i)}}const Je=new o,$e=new o,et=new o,tt=new o,st=new o,nt=new o,it=new o,ot=new o;new o,new o;new o,new o;new o,new o;new o,new o;new o,new o;class rt extends Ue{constructor(e,t,s){super(e,t,-s,s),this.ri=new o,this.rj=new o,this.t=new o}computeB(e){this.a;const t=this.b;this.bi,this.bj;const s=this.ri,n=this.rj,i=at,o=lt,r=this.t;s.cross(r,i),n.cross(r,o);const a=this.jacobianElementA,l=this.jacobianElementB;r.negate(a.spatial),i.negate(a.rotational),l.spatial.copy(r),l.rotational.copy(o);return-this.computeGW()*t-e*this.computeGiMf()}}const at=new o,lt=new o;class ct{constructor(e,t,s){s=He.defaults(s,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ct.idCounter++,this.materials=[e,t],this.friction=s.friction,this.restitution=s.restitution,this.contactEquationStiffness=s.contactEquationStiffness,this.contactEquationRelaxation=s.contactEquationRelaxation,this.frictionEquationStiffness=s.frictionEquationStiffness,this.frictionEquationRelaxation=s.frictionEquationRelaxation}}ct.idCounter=0;class ht{constructor(e){void 0===e&&(e={});let t="";"string"==typeof e&&(t=e,e={}),this.name=t,this.id=ht.idCounter++,this.friction=void 0!==e.friction?e.friction:-1,this.restitution=void 0!==e.restitution?e.restitution:-1}}ht.idCounter=0;new o,new o,new o,new o,new o,new o,new o,new o,new o,new o,new o;new o,new o;new o,new o,new o;new o,new o,new o;new ue,new o;new o,new o,new o(1,0,0),new o(0,1,0),new o(0,0,1),new o,new o,new o,new o;new o,new o,new o,new o;new o,new o,new o;new o,new o;new o,new o,new o,new o,new o,new o,new o;class ut extends x{constructor(e,t,s,n){if(void 0===e&&(e=1),void 0===t&&(t=1),void 0===s&&(s=1),void 0===n&&(n=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const i=n,r=[],a=[],l=[],c=[],h=[],u=Math.cos,d=Math.sin;r.push(new o(-t*d(0),.5*-s,t*u(0))),c.push(0),r.push(new o(-e*d(0),.5*s,e*u(0))),h.push(1);for(let n=0;n<i;n++){const p=2*Math.PI/i*(n+1),f=2*Math.PI/i*(n+.5);n<i-1?(r.push(new o(-t*d(p),.5*-s,t*u(p))),c.push(2*n+2),r.push(new o(-e*d(p),.5*s,e*u(p))),h.push(2*n+3),l.push([2*n,2*n+1,2*n+3,2*n+2])):l.push([2*n,2*n+1,1,0]),(i%2==1||n<i/2)&&a.push(new o(-d(f),0,u(f)))}l.push(c),a.push(new o(0,1,0));const p=[];for(let e=0;e<h.length;e++)p.push(h[h.length-e-1]);l.push(p),super({vertices:r,faces:l,axes:a}),this.type=v.types.CYLINDER,this.radiusTop=e,this.radiusBottom=t,this.height=s,this.numSegments=n}}new o;new o,new o,new o,new o,new o,new o,new o,new o,new o;new o,new c;new o,new c,new o,new o,new o,new o,new o,new o,new o,new c,new o,new g,new c;class dt{constructor(){this.equations=[]}solve(e,t){return 0}addEquation(e){!e.enabled||e.bi.isTrigger||e.bj.isTrigger||this.equations.push(e)}removeEquation(e){const t=this.equations,s=t.indexOf(e);-1!==s&&t.splice(s,1)}removeAllEquations(){this.equations.length=0}}class pt extends dt{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(e,t){let s=0;const n=this.iterations,i=this.tolerance*this.tolerance,o=this.equations,r=o.length,a=t.bodies,l=a.length,c=e;let h,u,d,p,f,m;if(0!==r)for(let e=0;e!==l;e++)a[e].updateSolveMassProperties();const y=mt,v=yt,g=ft;y.length=r,v.length=r,g.length=r;for(let e=0;e!==r;e++){const t=o[e];g[e]=0,v[e]=t.computeB(c),y[e]=1/t.computeC()}if(0!==r){for(let e=0;e!==l;e++){const t=a[e],s=t.vlambda,n=t.wlambda;s.set(0,0,0),n.set(0,0,0)}for(s=0;s!==n;s++){p=0;for(let e=0;e!==r;e++){const t=o[e];h=v[e],u=y[e],m=g[e],f=t.computeGWlambda(),d=u*(h-f-t.eps*m),m+d<t.minForce?d=t.minForce-m:m+d>t.maxForce&&(d=t.maxForce-m),g[e]+=d,p+=d>0?d:-d,t.addToWlambda(d)}if(p*p<i)break}for(let e=0;e!==l;e++){const t=a[e],s=t.velocity,n=t.angularVelocity;t.vlambda.vmul(t.linearFactor,t.vlambda),s.vadd(t.vlambda,s),t.wlambda.vmul(t.angularFactor,t.wlambda),n.vadd(t.wlambda,n)}let e=o.length;const t=1/c;for(;e--;)o[e].multiplier=g[e]*t}return s}}const ft=[],mt=[],yt=[];L.STATIC;class vt{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}get(){return 0===this.objects.length?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const t=this.objects;for(;t.length>e;)t.pop();for(;t.length<e;)t.push(this.constructObject());return this}}class gt extends vt{constructor(){super(...arguments),this.type=o}constructObject(){return new o}}const wt=v.types.SPHERE,xt=v.types.SPHERE|v.types.PLANE,bt=v.types.BOX|v.types.BOX,At=v.types.SPHERE|v.types.BOX,Et=v.types.PLANE|v.types.BOX,Tt=v.types.CONVEXPOLYHEDRON,Ct=v.types.SPHERE|v.types.CONVEXPOLYHEDRON,St=v.types.PLANE|v.types.CONVEXPOLYHEDRON,Rt=v.types.BOX|v.types.CONVEXPOLYHEDRON,Pt=v.types.SPHERE|v.types.HEIGHTFIELD,Mt=v.types.BOX|v.types.HEIGHTFIELD,It=v.types.CONVEXPOLYHEDRON|v.types.HEIGHTFIELD,Ft=v.types.PARTICLE|v.types.SPHERE,Nt=v.types.PLANE|v.types.PARTICLE,Bt=v.types.BOX|v.types.PARTICLE,Lt=v.types.PARTICLE|v.types.CONVEXPOLYHEDRON,_t=v.types.CYLINDER,zt=v.types.SPHERE|v.types.CYLINDER,Ot=v.types.PLANE|v.types.CYLINDER,kt=v.types.BOX|v.types.CYLINDER,jt=v.types.CONVEXPOLYHEDRON|v.types.CYLINDER,qt=v.types.HEIGHTFIELD|v.types.CYLINDER,Ht=v.types.PARTICLE|v.types.CYLINDER,Dt=v.types.SPHERE|v.types.TRIMESH,Vt=v.types.PLANE|v.types.TRIMESH;class Ut{get[wt](){return this.sphereSphere}get[xt](){return this.spherePlane}get[bt](){return this.boxBox}get[At](){return this.sphereBox}get[Et](){return this.planeBox}get[Tt](){return this.convexConvex}get[Ct](){return this.sphereConvex}get[St](){return this.planeConvex}get[Rt](){return this.boxConvex}get[Pt](){return this.sphereHeightfield}get[Mt](){return this.boxHeightfield}get[It](){return this.convexHeightfield}get[Ft](){return this.sphereParticle}get[Nt](){return this.planeParticle}get[Bt](){return this.boxParticle}get[Lt](){return this.convexParticle}get[_t](){return this.convexConvex}get[zt](){return this.sphereConvex}get[Ot](){return this.planeConvex}get[kt](){return this.boxConvex}get[jt](){return this.convexConvex}get[qt](){return this.heightfieldCylinder}get[Ht](){return this.particleCylinder}get[Dt](){return this.sphereTrimesh}get[Vt](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new gt,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,t,s,n,i,o){let r;this.contactPointPool.length?(r=this.contactPointPool.pop(),r.bi=e,r.bj=t):r=new Qe(e,t),r.enabled=e.collisionResponse&&t.collisionResponse&&s.collisionResponse&&n.collisionResponse;const a=this.currentContactMaterial;r.restitution=a.restitution,r.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);const l=s.material||e.material,c=n.material||t.material;return l&&c&&l.restitution>=0&&c.restitution>=0&&(r.restitution=l.restitution*c.restitution),r.si=i||s,r.sj=o||n,r}createFrictionEquationsFromContact(e,t){const s=e.bi,n=e.bj,i=e.si,o=e.sj,r=this.world,a=this.currentContactMaterial;let l=a.friction;const c=i.material||s.material,h=o.material||n.material;if(c&&h&&c.friction>=0&&h.friction>=0&&(l=c.friction*h.friction),l>0){const i=l*(r.frictionGravity||r.gravity).length();let o=s.invMass+n.invMass;o>0&&(o=1/o);const c=this.frictionEquationPool,h=c.length?c.pop():new rt(s,n,i*o),u=c.length?c.pop():new rt(s,n,i*o);return h.bi=u.bi=s,h.bj=u.bj=n,h.minForce=u.minForce=-i*o,h.maxForce=u.maxForce=i*o,h.ri.copy(e.ri),h.rj.copy(e.rj),u.ri.copy(e.ri),u.rj.copy(e.rj),e.ni.tangents(h.t,u.t),h.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),u.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,r.dt),h.enabled=u.enabled=e.enabled,t.push(h,u),!0}return!1}createFrictionFromAverage(e){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||1===e)return;const s=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];Gt.setZero(),Wt.setZero(),Kt.setZero();const i=t.bi;t.bj;for(let s=0;s!==e;s++)t=this.result[this.result.length-1-s],t.bi!==i?(Gt.vadd(t.ni,Gt),Wt.vadd(t.ri,Wt),Kt.vadd(t.rj,Kt)):(Gt.vsub(t.ni,Gt),Wt.vadd(t.rj,Wt),Kt.vadd(t.ri,Kt));const o=1/e;Wt.scale(o,s.ri),Kt.scale(o,s.rj),n.ri.copy(s.ri),n.rj.copy(s.rj),Gt.normalize(),Gt.tangents(s.t,n.t)}getContacts(e,t,s,n,i,o,r){this.contactPointPool=i,this.frictionEquationPool=r,this.result=n,this.frictionResult=o;const a=Zt,l=Qt,c=Xt,h=Yt;for(let n=0,i=e.length;n!==i;n++){const i=e[n],o=t[n];let r=null;i.material&&o.material&&(r=s.getContactMaterial(i.material,o.material)||null);const u=i.type&L.KINEMATIC&&o.type&L.STATIC||i.type&L.STATIC&&o.type&L.KINEMATIC||i.type&L.KINEMATIC&&o.type&L.KINEMATIC;for(let e=0;e<i.shapes.length;e++){i.quaternion.mult(i.shapeOrientations[e],a),i.quaternion.vmult(i.shapeOffsets[e],c),c.vadd(i.position,c);const t=i.shapes[e];for(let e=0;e<o.shapes.length;e++){o.quaternion.mult(o.shapeOrientations[e],l),o.quaternion.vmult(o.shapeOffsets[e],h),h.vadd(o.position,h);const n=o.shapes[e];if(!(t.collisionFilterMask&n.collisionFilterGroup&&n.collisionFilterMask&t.collisionFilterGroup))continue;if(c.distanceTo(h)>t.boundingSphereRadius+n.boundingSphereRadius)continue;let d=null;t.material&&n.material&&(d=s.getContactMaterial(t.material,n.material)||null),this.currentContactMaterial=d||r||s.defaultContactMaterial;const p=this[t.type|n.type];if(p){let e=!1;e=t.type<n.type?p.call(this,t,n,c,h,a,l,i,o,t,n,u):p.call(this,n,t,h,c,l,a,o,i,t,n,u),e&&u&&(s.shapeOverlapKeeper.set(t.id,n.id),s.bodyOverlapKeeper.set(i.id,o.id))}}}}}sphereSphere(e,t,s,n,i,o,r,a,l,c,h){if(h)return s.distanceSquared(n)<(e.radius+t.radius)**2;const u=this.createContactEquation(r,a,e,t,l,c);n.vsub(s,u.ni),u.ni.normalize(),u.ri.copy(u.ni),u.rj.copy(u.ni),u.ri.scale(e.radius,u.ri),u.rj.scale(-t.radius,u.rj),u.ri.vadd(s,u.ri),u.ri.vsub(r.position,u.ri),u.rj.vadd(n,u.rj),u.rj.vsub(a.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}spherePlane(e,t,s,n,i,o,r,a,l,c,h){const u=this.createContactEquation(r,a,e,t,l,c);if(u.ni.set(0,0,1),o.vmult(u.ni,u.ni),u.ni.negate(u.ni),u.ni.normalize(),u.ni.scale(e.radius,u.ri),s.vsub(n,ys),u.ni.scale(u.ni.dot(ys),vs),ys.vsub(vs,u.rj),-ys.dot(u.ni)<=e.radius){if(h)return!0;const e=u.ri,t=u.rj;e.vadd(s,e),e.vsub(r.position,e),t.vadd(n,t),t.vsub(a.position,t),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}}boxBox(e,t,s,n,i,o,r,a,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,s,n,i,o,r,a,e,t,h)}sphereBox(e,t,s,n,i,o,r,a,l,c,h){const u=this.v3pool,d=Ss;s.vsub(n,As),t.getSideNormals(d,o);const p=e.radius;let f=!1;const m=Ps,y=Ms,v=Is;let g=null,w=0,x=0,b=0,A=null;for(let e=0,t=d.length;e!==t&&!1===f;e++){const t=Es;t.copy(d[e]);const s=t.length();t.normalize();const n=As.dot(t);if(n<s+p&&n>0){const i=Ts,o=Cs;i.copy(d[(e+1)%3]),o.copy(d[(e+2)%3]);const r=i.length(),a=o.length();i.normalize(),o.normalize();const l=As.dot(i),c=As.dot(o);if(l<r&&l>-r&&c<a&&c>-a){const e=Math.abs(n-s-p);if((null===A||e<A)&&(A=e,x=l,b=c,g=s,m.copy(t),y.copy(i),v.copy(o),w++,h))return!0}}}if(w){f=!0;const i=this.createContactEquation(r,a,e,t,l,c);m.scale(-p,i.ri),i.ni.copy(m),i.ni.negate(i.ni),m.scale(g,m),y.scale(x,y),m.vadd(y,m),v.scale(b,v),m.vadd(v,i.rj),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),i.rj.vadd(n,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}let E=u.get();const T=Rs;for(let i=0;2!==i&&!f;i++)for(let o=0;2!==o&&!f;o++)for(let u=0;2!==u&&!f;u++)if(E.set(0,0,0),i?E.vadd(d[0],E):E.vsub(d[0],E),o?E.vadd(d[1],E):E.vsub(d[1],E),u?E.vadd(d[2],E):E.vsub(d[2],E),n.vadd(E,T),T.vsub(s,T),T.lengthSquared()<p*p){if(h)return!0;f=!0;const i=this.createContactEquation(r,a,e,t,l,c);i.ri.copy(T),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(p,i.ri),i.rj.copy(E),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),i.rj.vadd(n,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}u.release(E),E=null;const C=u.get(),S=u.get(),R=u.get(),P=u.get(),M=u.get(),I=d.length;for(let i=0;i!==I&&!f;i++)for(let o=0;o!==I&&!f;o++)if(i%3!=o%3){d[o].cross(d[i],C),C.normalize(),d[i].vadd(d[o],S),R.copy(s),R.vsub(S,R),R.vsub(n,R);const u=R.dot(C);C.scale(u,P);let m=0;for(;m===i%3||m===o%3;)m++;M.copy(s),M.vsub(P,M),M.vsub(S,M),M.vsub(n,M);const y=Math.abs(u),v=M.length();if(y<d[m].length()&&v<p){if(h)return!0;f=!0;const i=this.createContactEquation(r,a,e,t,l,c);S.vadd(P,i.rj),i.rj.copy(i.rj),M.negate(i.ni),i.ni.normalize(),i.ri.copy(i.rj),i.ri.vadd(n,i.ri),i.ri.vsub(s,i.ri),i.ri.normalize(),i.ri.scale(p,i.ri),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),i.rj.vadd(n,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}u.release(C,S,R,P,M)}planeBox(e,t,s,n,i,o,r,a,l,c,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,s,n,i,o,r,a,e,t,h)}convexConvex(e,t,s,n,i,o,r,a,l,c,h,u,d){const p=Gs;if(!(s.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,s,i,n,o,p,u,d)){const u=[],d=Ws;e.clipAgainstHull(s,i,t,n,o,p,-100,100,u);let f=0;for(let i=0;i!==u.length;i++){if(h)return!0;const o=this.createContactEquation(r,a,e,t,l,c),m=o.ri,y=o.rj;p.negate(o.ni),u[i].normal.negate(d),d.scale(u[i].depth,d),u[i].point.vadd(d,m),y.copy(u[i].point),m.vsub(s,m),y.vsub(n,y),m.vadd(s,m),m.vsub(r.position,m),y.vadd(n,y),y.vsub(a.position,y),this.result.push(o),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(o,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}sphereConvex(e,t,s,n,i,o,r,a,l,c,h){const u=this.v3pool;s.vsub(n,Fs);const d=t.faceNormals,p=t.faces,f=t.vertices,m=e.radius;let y=!1;for(let i=0;i!==f.length;i++){const u=f[i],d=_s;o.vmult(u,d),n.vadd(d,d);const p=Ls;if(d.vsub(s,p),p.lengthSquared()<m*m){if(h)return!0;y=!0;const i=this.createContactEquation(r,a,e,t,l,c);return i.ri.copy(p),i.ri.normalize(),i.ni.copy(i.ri),i.ri.scale(m,i.ri),d.vsub(n,i.rj),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),i.rj.vadd(n,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),void this.createFrictionEquationsFromContact(i,this.frictionResult)}}for(let i=0,v=p.length;i!==v&&!1===y;i++){const v=d[i],g=p[i],w=zs;o.vmult(v,w);const x=Os;o.vmult(f[g[0]],x),x.vadd(n,x);const b=ks;w.scale(-m,b),s.vadd(b,b);const A=js;b.vsub(x,A);const E=A.dot(w),T=qs;if(s.vsub(x,T),E<0&&T.dot(w)>0){const i=[];for(let e=0,t=g.length;e!==t;e++){const t=u.get();o.vmult(f[g[e]],t),n.vadd(t,t),i.push(t)}if(bs(i,w,s)){if(h)return!0;y=!0;const o=this.createContactEquation(r,a,e,t,l,c);w.scale(-m,o.ri),w.negate(o.ni);const d=u.get();w.scale(-E,d);const p=u.get();w.scale(-m,p),s.vsub(n,o.rj),o.rj.vadd(p,o.rj),o.rj.vadd(d,o.rj),o.rj.vadd(n,o.rj),o.rj.vsub(a.position,o.rj),o.ri.vadd(s,o.ri),o.ri.vsub(r.position,o.ri),u.release(d),u.release(p),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult);for(let e=0,t=i.length;e!==t;e++)u.release(i[e]);return}for(let d=0;d!==g.length;d++){const p=u.get(),y=u.get();o.vmult(f[g[(d+1)%g.length]],p),o.vmult(f[g[(d+2)%g.length]],y),n.vadd(p,p),n.vadd(y,y);const v=Ns;y.vsub(p,v);const w=Bs;v.unit(w);const x=u.get(),b=u.get();s.vsub(p,b);const A=b.dot(w);w.scale(A,x),x.vadd(p,x);const E=u.get();if(x.vsub(s,E),A>0&&A*A<v.lengthSquared()&&E.lengthSquared()<m*m){if(h)return!0;const o=this.createContactEquation(r,a,e,t,l,c);x.vsub(n,o.rj),x.vsub(s,o.ni),o.ni.normalize(),o.ni.scale(m,o.ri),o.rj.vadd(n,o.rj),o.rj.vsub(a.position,o.rj),o.ri.vadd(s,o.ri),o.ri.vsub(r.position,o.ri),this.result.push(o),this.createFrictionEquationsFromContact(o,this.frictionResult);for(let e=0,t=i.length;e!==t;e++)u.release(i[e]);return u.release(p),u.release(y),u.release(x),u.release(E),void u.release(b)}u.release(p),u.release(y),u.release(x),u.release(E),u.release(b)}for(let e=0,t=i.length;e!==t;e++)u.release(i[e])}}}planeConvex(e,t,s,n,i,o,r,a,l,c,h){const u=Hs,d=Ds;d.set(0,0,1),i.vmult(d,d);let p=0;const f=Vs;for(let i=0;i!==t.vertices.length;i++){u.copy(t.vertices[i]),o.vmult(u,u),n.vadd(u,u),u.vsub(s,f);if(d.dot(f)<=0){if(h)return!0;const i=this.createContactEquation(r,a,e,t,l,c),o=Us;d.scale(d.dot(f),o),u.vsub(o,o),o.vsub(s,i.ri),i.ni.copy(d),u.vsub(n,i.rj),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),i.rj.vadd(n,i.rj),i.rj.vsub(a.position,i.rj),this.result.push(i),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(i,this.frictionResult)}}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}boxConvex(e,t,s,n,i,o,r,a,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,s,n,i,o,r,a,e,t,h)}sphereHeightfield(e,t,s,n,i,o,r,a,l,c,h){const u=t.data,d=e.radius,p=t.elementSize,f=an,m=rn;g.pointToLocalFrame(n,o,s,m);let y=Math.floor((m.x-d)/p)-1,v=Math.ceil((m.x+d)/p)+1,w=Math.floor((m.y-d)/p)-1,x=Math.ceil((m.y+d)/p)+1;if(v<0||x<0||y>u.length||w>u[0].length)return;y<0&&(y=0),v<0&&(v=0),w<0&&(w=0),x<0&&(x=0),y>=u.length&&(y=u.length-1),v>=u.length&&(v=u.length-1),x>=u[0].length&&(x=u[0].length-1),w>=u[0].length&&(w=u[0].length-1);const b=[];t.getRectMinMax(y,w,v,x,b);const A=b[0],E=b[1];if(m.z-d>E||m.z+d<A)return;const T=this.result;for(let l=y;l<v;l++)for(let c=w;c<x;c++){const u=T.length;let d=!1;if(t.getConvexTrianglePillar(l,c,!1),g.pointToWorldFrame(n,o,t.pillarOffset,f),s.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,s,f,i,o,r,a,e,t,h)),h&&d)return!0;if(t.getConvexTrianglePillar(l,c,!0),g.pointToWorldFrame(n,o,t.pillarOffset,f),s.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(d=this.sphereConvex(e,t.pillarConvex,s,f,i,o,r,a,e,t,h)),h&&d)return!0;if(T.length-u>2)return}}boxHeightfield(e,t,s,n,i,o,r,a,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,s,n,i,o,r,a,e,t,h)}convexHeightfield(e,t,s,n,i,o,r,a,l,c,h){const u=t.data,d=t.elementSize,p=e.boundingSphereRadius,f=nn,m=on,y=sn;g.pointToLocalFrame(n,o,s,y);let v=Math.floor((y.x-p)/d)-1,w=Math.ceil((y.x+p)/d)+1,x=Math.floor((y.y-p)/d)-1,b=Math.ceil((y.y+p)/d)+1;if(w<0||b<0||v>u.length||x>u[0].length)return;v<0&&(v=0),w<0&&(w=0),x<0&&(x=0),b<0&&(b=0),v>=u.length&&(v=u.length-1),w>=u.length&&(w=u.length-1),b>=u[0].length&&(b=u[0].length-1),x>=u[0].length&&(x=u[0].length-1);const A=[];t.getRectMinMax(v,x,w,b,A);const E=A[0],T=A[1];if(!(y.z-p>T||y.z+p<E))for(let l=v;l<w;l++)for(let c=x;c<b;c++){let u=!1;if(t.getConvexTrianglePillar(l,c,!1),g.pointToWorldFrame(n,o,t.pillarOffset,f),s.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(u=this.convexConvex(e,t.pillarConvex,s,f,i,o,r,a,null,null,h,m,null)),h&&u)return!0;if(t.getConvexTrianglePillar(l,c,!0),g.pointToWorldFrame(n,o,t.pillarOffset,f),s.distanceTo(f)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(u=this.convexConvex(e,t.pillarConvex,s,f,i,o,r,a,null,null,h,m,null)),h&&u)return!0}}sphereParticle(e,t,s,n,i,o,r,a,l,c,h){const u=Zs;u.set(0,0,1),n.vsub(s,u);if(u.lengthSquared()<=e.radius*e.radius){if(h)return!0;const s=this.createContactEquation(a,r,t,e,l,c);u.normalize(),s.rj.copy(u),s.rj.scale(e.radius,s.rj),s.ni.copy(u),s.ni.negate(s.ni),s.ri.set(0,0,0),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}}planeParticle(e,t,s,n,i,o,r,a,l,c,h){const u=Ks;u.set(0,0,1),r.quaternion.vmult(u,u);const d=Xs;n.vsub(r.position,d);if(u.dot(d)<=0){if(h)return!0;const s=this.createContactEquation(a,r,t,e,l,c);s.ni.copy(u),s.ni.negate(s.ni),s.ri.set(0,0,0);const i=Ys;u.scale(u.dot(n),i),n.vsub(i,i),s.rj.copy(i),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}}boxParticle(e,t,s,n,i,o,r,a,l,c,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,s,n,i,o,r,a,e,t,h)}convexParticle(e,t,s,n,i,o,r,a,l,c,h){let u=-1;const d=$s,p=tn;let f=null;const m=Js;if(m.copy(n),m.vsub(s,m),i.conjugate(Qs),Qs.vmult(m,m),e.pointIsInside(m)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(s,i),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(i);for(let t=0,s=e.faces.length;t!==s;t++){const s=[e.worldVertices[e.faces[t][0]]],i=e.worldFaceNormals[t];n.vsub(s[0],en);const o=-i.dot(en);if(null===f||Math.abs(o)<Math.abs(f)){if(h)return!0;f=o,u=t,d.copy(i)}}if(-1!==u){const i=this.createContactEquation(a,r,t,e,l,c);d.scale(f,p),p.vadd(n,p),p.vsub(s,p),i.rj.copy(p),d.negate(i.ni),i.ri.set(0,0,0);const o=i.ri,h=i.rj;o.vadd(n,o),o.vsub(a.position,o),h.vadd(s,h),h.vsub(r.position,h),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}}heightfieldCylinder(e,t,s,n,i,o,r,a,l,c,h){return this.convexHeightfield(t,e,n,s,o,i,a,r,l,c,h)}particleCylinder(e,t,s,n,i,o,r,a,l,c,h){return this.convexParticle(t,e,n,s,o,i,a,r,l,c,h)}sphereTrimesh(e,t,s,n,i,o,r,a,l,c,h){const u=os,d=rs,p=as,f=ls,m=cs,y=hs,v=fs,w=is,x=ss,b=ms;g.pointToLocalFrame(n,o,s,m);const A=e.radius;v.lowerBound.set(m.x-A,m.y-A,m.z-A),v.upperBound.set(m.x+A,m.y+A,m.z+A),t.getTrianglesInAABB(v,b);const E=ns,T=e.radius*e.radius;for(let i=0;i<b.length;i++)for(let u=0;u<3;u++)if(t.getVertex(t.indices[3*b[i]+u],E),E.vsub(m,x),x.lengthSquared()<=T){if(w.copy(E),g.pointToWorldFrame(n,o,w,E),E.vsub(s,x),h)return!0;let i=this.createContactEquation(r,a,e,t,l,c);i.ni.copy(x),i.ni.normalize(),i.ri.copy(i.ni),i.ri.scale(e.radius,i.ri),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),i.rj.copy(E),i.rj.vsub(a.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}for(let i=0;i<b.length;i++)for(let v=0;v<3;v++){t.getVertex(t.indices[3*b[i]+v],u),t.getVertex(t.indices[3*b[i]+(v+1)%3],d),d.vsub(u,p),m.vsub(d,y);const w=y.dot(p);m.vsub(u,y);let x=y.dot(p);if(x>0&&w<0){m.vsub(u,y),f.copy(p),f.normalize(),x=y.dot(f),f.scale(x,y),y.vadd(u,y);if(y.distanceTo(m)<e.radius){if(h)return!0;const i=this.createContactEquation(r,a,e,t,l,c);y.vsub(m,i.ni),i.ni.normalize(),i.ni.scale(e.radius,i.ri),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),g.pointToWorldFrame(n,o,y,y),y.vsub(a.position,i.rj),g.vectorToWorldFrame(o,i.ni,i.ni),g.vectorToWorldFrame(o,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}}const C=us,S=ds,R=ps,P=ts;for(let i=0,u=b.length;i!==u;i++){t.getTriangleVertices(b[i],C,S,R),t.getNormal(b[i],P),m.vsub(C,y);let u=y.dot(P);if(P.scale(u,y),m.vsub(y,y),u=y.distanceTo(m),ue.pointInTriangle(y,C,S,R)&&u<e.radius){if(h)return!0;let i=this.createContactEquation(r,a,e,t,l,c);y.vsub(m,i.ni),i.ni.normalize(),i.ni.scale(e.radius,i.ri),i.ri.vadd(s,i.ri),i.ri.vsub(r.position,i.ri),g.pointToWorldFrame(n,o,y,y),y.vsub(a.position,i.rj),g.vectorToWorldFrame(o,i.ni,i.ni),g.vectorToWorldFrame(o,i.ri,i.ri),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}}b.length=0}planeTrimesh(e,t,s,n,i,r,a,l,c,h,u){const d=new o,p=Jt;p.set(0,0,1),i.vmult(p,p);for(let i=0;i<t.vertices.length/3;i++){t.getVertex(i,d);const f=new o;f.copy(d),g.pointToWorldFrame(n,r,f,d);const m=$t;d.vsub(s,m);if(p.dot(m)<=0){if(u)return!0;const s=this.createContactEquation(a,l,e,t,c,h);s.ni.copy(p);const n=es;p.scale(m.dot(p),n),d.vsub(n,n),s.ri.copy(n),s.ri.vsub(a.position,s.ri),s.rj.copy(d),s.rj.vsub(l.position,s.rj),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult)}}}}const Gt=new o,Wt=new o,Kt=new o,Xt=new o,Yt=new o,Zt=new f,Qt=new f,Jt=new o,$t=new o,es=new o,ts=new o,ss=new o;new o;const ns=new o,is=new o,os=new o,rs=new o,as=new o,ls=new o,cs=new o,hs=new o,us=new o,ds=new o,ps=new o,fs=new c,ms=[],ys=new o,vs=new o,gs=new o,ws=new o,xs=new o;function bs(e,t,s){let n=null;const i=e.length;for(let o=0;o!==i;o++){const r=e[o],a=gs;e[(o+1)%i].vsub(r,a);const l=ws;a.cross(t,l);const c=xs;s.vsub(r,c);const h=l.dot(c);if(!(null===n||h>0&&!0===n||h<=0&&!1===n))return!1;null===n&&(n=h>0)}return!0}const As=new o,Es=new o,Ts=new o,Cs=new o,Ss=[new o,new o,new o,new o,new o,new o],Rs=new o,Ps=new o,Ms=new o,Is=new o,Fs=new o,Ns=new o,Bs=new o,Ls=new o,_s=new o,zs=new o,Os=new o,ks=new o,js=new o,qs=new o;new o,new o;const Hs=new o,Ds=new o,Vs=new o,Us=new o,Gs=new o,Ws=new o,Ks=new o,Xs=new o,Ys=new o,Zs=new o,Qs=new f,Js=new o;new o;const $s=new o,en=new o,tn=new o,sn=new o,nn=new o,on=[0],rn=new o,an=new o;class ln{constructor(){this.current=[],this.previous=[]}getKey(e,t){if(t<e){const s=t;t=e,e=s}return e<<16|t}set(e,t){const s=this.getKey(e,t),n=this.current;let i=0;for(;s>n[i];)i++;if(s!==n[i]){for(let e=n.length-1;e>=i;e--)n[e+1]=n[e];n[i]=s}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,t){const s=this.current,n=this.previous,i=s.length,o=n.length;let r=0;for(let t=0;t<i;t++){let i=!1;const o=s[t];for(;o>n[r];)r++;i=o===n[r],i||cn(e,o)}r=0;for(let e=0;e<o;e++){let i=!1;const o=n[e];for(;o>s[r];)r++;i=s[r]===o,i||cn(t,o)}}}function cn(e,t){e.push((4294901760&t)>>16,65535&t)}const hn=(e,t)=>e<t?"".concat(e,"-").concat(t):"".concat(t,"-").concat(e);class un{constructor(){this.data={keys:[]}}get(e,t){const s=hn(e,t);return this.data[s]}set(e,t,s){const n=hn(e,t);this.get(e,t)||this.data.keys.push(n),this.data[n]=s}delete(e,t){const s=hn(e,t),n=this.data.keys.indexOf(s);-1!==n&&this.data.keys.splice(n,1),delete this.data[s]}reset(){const e=this.data,t=e.keys;for(;t.length>0;){delete e[t.pop()]}}}class dn extends p{constructor(e){void 0===e&&(e={}),super(),this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=void 0!==e.quatNormalizeSkip?e.quatNormalizeSkip:0,this.quatNormalizeFast=void 0!==e.quatNormalizeFast&&e.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new o,e.gravity&&this.gravity.copy(e.gravity),e.frictionGravity&&(this.frictionGravity=new o,this.frictionGravity.copy(e.frictionGravity)),this.broadphase=void 0!==e.broadphase?e.broadphase:new $,this.bodies=[],this.hasActiveBodies=!1,this.solver=void 0!==e.solver?e.solver:new pt,this.constraints=[],this.narrowphase=new Ut(this),this.collisionMatrix=new d,this.collisionMatrixPrevious=new d,this.bodyOverlapKeeper=new ln,this.shapeOverlapKeeper=new ln,this.contactmaterials=[],this.contactMaterialTable=new un,this.defaultMaterial=new ht("default"),this.defaultContactMaterial=new ct(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,t){return this.contactMaterialTable.get(e.id,t.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}rayTest(e,t,s){s instanceof ee?this.raycastClosest(e,t,{skipBackfaces:!0},s):this.raycastAll(e,t,{skipBackfaces:!0},s)}raycastAll(e,t,s,n){return void 0===s&&(s={}),s.mode=ue.ALL,s.from=e,s.to=t,s.callback=n,pn.intersectWorld(this,s)}raycastAny(e,t,s,n){return void 0===s&&(s={}),s.mode=ue.ANY,s.from=e,s.to=t,s.result=n,pn.intersectWorld(this,s)}raycastClosest(e,t,s,n){return void 0===s&&(s={}),s.mode=ue.CLOSEST,s.from=e,s.to=t,s.result=n,pn.intersectWorld(this,s)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof L&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const t=this.bodies.length-1,s=this.bodies,n=s.indexOf(e);if(-1!==n){s.splice(n,1);for(let e=0;e!==s.length;e++)s[e].index=e;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const t=this.bodies;for(let s=0;s<t.length;s++){const n=t[s].shapes;for(let t=0;t<n.length;t++){const s=n[t];if(s.id===e)return s}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const t=this.contactmaterials.indexOf(e);-1!==t&&(this.contactmaterials.splice(t,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,t){void 0===e&&(e=1/60),void 0===t&&(t=10);const s=fn.now()/1e3;if(this.lastCallTime){const n=s-this.lastCallTime;this.step(e,n,t)}else this.step(e,void 0,t);this.lastCallTime=s}step(e,t,s){if(void 0===s&&(s=10),void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;const n=fn.now();let i=0;for(;this.accumulator>=e&&i<s&&(this.internalStep(e),this.accumulator-=e,i++,!(fn.now()-n>1e3*e)););this.accumulator=this.accumulator%e;const o=this.accumulator/e;for(let e=0;e!==this.bodies.length;e++){const t=this.bodies[e];t.previousPosition.lerp(t.position,o,t.interpolatedPosition),t.previousQuaternion.slerp(t.quaternion,o,t.interpolatedQuaternion),t.previousQuaternion.normalize()}this.time+=t}}internalStep(e){this.dt=e;const t=this.contacts,s=xn,n=bn,i=this.bodies.length,o=this.bodies,r=this.solver,a=this.gravity,l=this.doProfiling,c=this.profile,h=L.DYNAMIC;let u=-1/0;const d=this.constraints,p=wn;a.length();const f=a.x,m=a.y,y=a.z;let v=0;for(l&&(u=fn.now()),v=0;v!==i;v++){const e=o[v];if(e.type===h){const t=e.force,s=e.mass;t.x+=s*f,t.y+=s*m,t.z+=s*y}}for(let e=0,t=this.subsystems.length;e!==t;e++)this.subsystems[e].update();l&&(u=fn.now()),s.length=0,n.length=0,this.broadphase.collisionPairs(this,s,n),l&&(c.broadphase=fn.now()-u);let g=d.length;for(v=0;v!==g;v++){const e=d[v];if(!e.collideConnected)for(let t=s.length-1;t>=0;t-=1)(e.bodyA===s[t]&&e.bodyB===n[t]||e.bodyB===s[t]&&e.bodyA===n[t])&&(s.splice(t,1),n.splice(t,1))}this.collisionMatrixTick(),l&&(u=fn.now());const w=gn,x=t.length;for(v=0;v!==x;v++)w.push(t[v]);t.length=0;const b=this.frictionEquations.length;for(v=0;v!==b;v++)p.push(this.frictionEquations[v]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(s,n,this,t,w,this.frictionEquations,p),l&&(c.narrowphase=fn.now()-u),l&&(u=fn.now()),v=0;v<this.frictionEquations.length;v++)r.addEquation(this.frictionEquations[v]);const A=t.length;for(let e=0;e!==A;e++){const s=t[e],n=s.bi,i=s.bj,o=s.si,a=s.sj;let l;if(l=n.material&&i.material&&this.getContactMaterial(n.material,i.material)||this.defaultContactMaterial,l.friction,n.material&&i.material&&(n.material.friction>=0&&i.material.friction>=0&&(n.material.friction,i.material.friction),n.material.restitution>=0&&i.material.restitution>=0&&(s.restitution=n.material.restitution*i.material.restitution)),r.addEquation(s),n.allowSleep&&n.type===L.DYNAMIC&&n.sleepState===L.SLEEPING&&i.sleepState===L.AWAKE&&i.type!==L.STATIC){i.velocity.lengthSquared()+i.angularVelocity.lengthSquared()>=2*i.sleepSpeedLimit**2&&(n.wakeUpAfterNarrowphase=!0)}if(i.allowSleep&&i.type===L.DYNAMIC&&i.sleepState===L.SLEEPING&&n.sleepState===L.AWAKE&&n.type!==L.STATIC){n.velocity.lengthSquared()+n.angularVelocity.lengthSquared()>=2*n.sleepSpeedLimit**2&&(i.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(n,i,!0),this.collisionMatrixPrevious.get(n,i)||(vn.body=i,vn.contact=s,n.dispatchEvent(vn),vn.body=n,i.dispatchEvent(vn)),this.bodyOverlapKeeper.set(n.id,i.id),this.shapeOverlapKeeper.set(o.id,a.id)}for(this.emitContactEvents(),l&&(c.makeContactConstraints=fn.now()-u,u=fn.now()),v=0;v!==i;v++){const e=o[v];e.wakeUpAfterNarrowphase&&(e.wakeUp(),e.wakeUpAfterNarrowphase=!1)}for(g=d.length,v=0;v!==g;v++){const e=d[v];e.update();for(let t=0,s=e.equations.length;t!==s;t++){const s=e.equations[t];r.addEquation(s)}}r.solve(e,this),l&&(c.solve=fn.now()-u),r.removeAllEquations();const E=Math.pow;for(v=0;v!==i;v++){const t=o[v];if(t.type&h){const s=E(1-t.linearDamping,e),n=t.velocity;n.scale(s,n);const i=t.angularVelocity;if(i){const s=E(1-t.angularDamping,e);i.scale(s,i)}}}this.dispatchEvent(yn),l&&(u=fn.now());const T=this.stepnumber%(this.quatNormalizeSkip+1)==0,C=this.quatNormalizeFast;for(v=0;v!==i;v++)o[v].integrate(e,T,C);this.clearForces(),this.broadphase.dirty=!0,l&&(c.integrate=fn.now()-u),this.stepnumber+=1,this.dispatchEvent(mn);let S=!0;if(this.allowSleep)for(S=!1,v=0;v!==i;v++){const e=o[v];e.sleepTick(this.time),e.sleepState!==L.SLEEPING&&(S=!0)}this.hasActiveBodies=S}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((e||t)&&this.bodyOverlapKeeper.getDiff(An,En),e){for(let e=0,t=An.length;e<t;e+=2)Tn.bodyA=this.getBodyById(An[e]),Tn.bodyB=this.getBodyById(An[e+1]),this.dispatchEvent(Tn);Tn.bodyA=Tn.bodyB=null}if(t){for(let e=0,t=En.length;e<t;e+=2)Cn.bodyA=this.getBodyById(En[e]),Cn.bodyB=this.getBodyById(En[e+1]),this.dispatchEvent(Cn);Cn.bodyA=Cn.bodyB=null}An.length=En.length=0;const s=this.hasAnyEventListener("beginShapeContact"),n=this.hasAnyEventListener("endShapeContact");if((s||n)&&this.shapeOverlapKeeper.getDiff(An,En),s){for(let e=0,t=An.length;e<t;e+=2){const t=this.getShapeById(An[e]),s=this.getShapeById(An[e+1]);Sn.shapeA=t,Sn.shapeB=s,t&&(Sn.bodyA=t.body),s&&(Sn.bodyB=s.body),this.dispatchEvent(Sn)}Sn.bodyA=Sn.bodyB=Sn.shapeA=Sn.shapeB=null}if(n){for(let e=0,t=En.length;e<t;e+=2){const t=this.getShapeById(En[e]),s=this.getShapeById(En[e+1]);Rn.shapeA=t,Rn.shapeB=s,t&&(Rn.bodyA=t.body),s&&(Rn.bodyB=s.body),this.dispatchEvent(Rn)}Rn.bodyA=Rn.bodyB=Rn.shapeA=Rn.shapeB=null}}clearForces(){const e=this.bodies,t=e.length;for(let s=0;s!==t;s++){const t=e[s];t.force,t.torque,t.force.set(0,0,0),t.torque.set(0,0,0)}}}new c;const pn=new ue,fn=globalThis.performance||{};if(!fn.now){let e=Date.now();fn.timing&&fn.timing.navigationStart&&(e=fn.timing.navigationStart),fn.now=()=>Date.now()-e}new o;const mn={type:"postStep"},yn={type:"preStep"},vn={type:L.COLLIDE_EVENT_NAME,body:null,contact:null},gn=[],wn=[],xn=[],bn=[],An=[],En=[],Tn={type:"beginContact",bodyA:null,bodyB:null},Cn={type:"endContact",bodyA:null,bodyB:null},Sn={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Rn={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null}},2849:(e,t,s)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;t.splice(1,0,s,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e="MISSING_ENV_VAR".DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0)}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(6180)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},6180:(e,t,s)=>{e.exports=function(e){function t(e){let s,i,o,r=null;function a(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(!a.enabled)return;const o=a,r=Number(new Date),l=r-(s||r);o.diff=l,o.prev=s,o.curr=r,s=r,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let c=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,((e,s)=>{if("%%"===e)return"%";c++;const i=t.formatters[s];if("function"==typeof i){const t=n[c];e=i.call(o,t),n.splice(c,1),c--}return e})),t.formatArgs.call(o,n);(o.log||t.log).apply(o,n)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==r?r:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{r=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,s){const n=t(this.namespace+(void 0===s?":":s)+e);return n.log=this.log,n}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let s;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(s=0;s<i;s++)n[s]&&("-"===(e=n[s].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let s,n;for(s=0,n=t.skips.length;s<n;s++)if(t.skips[s].test(e))return!1;for(s=0,n=t.names.length;s<n;s++)if(t.names[s].test(e))return!0;return!1},t.humanize=s(5440),t.destroy=function(){},Object.keys(e).forEach((s=>{t[s]=e[s]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}},8704:e=>{"use strict";e.exports=function e(t,s){if(t===s)return!0;if(t&&s&&"object"==typeof t&&"object"==typeof s){if(t.constructor!==s.constructor)return!1;var n,i,o;if(Array.isArray(t)){if((n=t.length)!=s.length)return!1;for(i=n;0!=i--;)if(!e(t[i],s[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(s).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(s,o[i]))return!1;for(i=n;0!=i--;){var r=o[i];if(!e(t[r],s[r]))return!1}return!0}return t!=t&&s!=s}},6160:e=>{function t(e,t){e.onload=function(){this.onerror=this.onload=null,t(null,e)},e.onerror=function(){this.onerror=this.onload=null,t(new Error("Failed to load "+this.src),e)}}function s(e,t){e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,t(null,e))}}e.exports=function(e,n,i){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("script");"function"==typeof n&&(i=n,n={}),n=n||{},i=i||function(){},r.type=n.type||"text/javascript",r.charset=n.charset||"utf8",r.async=!("async"in n)||!!n.async,r.src=e,n.attrs&&function(e,t){for(var s in t)e.setAttribute(s,t[s])}(r,n.attrs),n.text&&(r.text=""+n.text),("onload"in r?t:s)(r,i),r.onload||t(r,i),o.appendChild(r)}},5440:e=>{var t=1e3,s=60*t,n=60*s,i=24*n,o=7*i,r=365.25*i;function a(e,t,s,n){var i=t>=1.5*s;return Math.round(e/s)+" "+n+(i?"s":"")}e.exports=function(e,l){l=l||{};var c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var l=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*r;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*i;case"hours":case"hour":case"hrs":case"hr":case"h":return l*n;case"minutes":case"minute":case"mins":case"min":case"m":return l*s;case"seconds":case"second":case"secs":case"sec":case"s":return l*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}(e);if("number"===c&&isFinite(e))return l.long?function(e){var o=Math.abs(e);if(o>=i)return a(e,o,i,"day");if(o>=n)return a(e,o,n,"hour");if(o>=s)return a(e,o,s,"minute");if(o>=t)return a(e,o,t,"second");return e+" ms"}(e):function(e){var o=Math.abs(e);if(o>=i)return Math.round(e/i)+"d";if(o>=n)return Math.round(e/n)+"h";if(o>=s)return Math.round(e/s)+"m";if(o>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},3433:(e,t,s)=>{"use strict";var n=s(6642);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,s,i,o,r){if(r!==n){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return s.PropTypes=s,s}},3074:(e,t,s)=>{e.exports=s(3433)()},6642:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},7308:(e,t,s)=>{"use strict";s.d(t,{Z:()=>T});var n=s(3074),i=s.n(n),o=s(7363),r=s.n(o),a=s(8704),l=s.n(a),c=s(2563),h=s.n(c),u=Object.defineProperty,d=Object.defineProperties,p=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,v=(e,t,s)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,g=(e,t)=>{for(var s in t||(t={}))m.call(t,s)&&v(e,s,t[s]);if(f)for(var s of f(t))y.call(t,s)&&v(e,s,t[s]);return e},w=(e,t)=>d(e,p(t));function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return w(g({},e),{height:0,width:0,playerVars:w(g({},e.playerVars),{autoplay:0,start:0,end:0})})}var b={videoId:i().string,id:i().string,className:i().string,iframeClassName:i().string,style:i().object,title:i().string,loading:i().oneOf(["lazy","eager"]),opts:i().objectOf(i().any),onReady:i().func,onError:i().func,onPlay:i().func,onPause:i().func,onEnd:i().func,onStateChange:i().func,onPlaybackRateChange:i().func,onPlaybackQualityChange:i().func},A=class extends r().Component{constructor(e){super(e),this.destroyPlayerPromise=void 0,this.onPlayerReady=e=>{var t,s;return null==(s=(t=this.props).onReady)?void 0:s.call(t,e)},this.onPlayerError=e=>{var t,s;return null==(s=(t=this.props).onError)?void 0:s.call(t,e)},this.onPlayerStateChange=e=>{var t,s,n,i,o,r,a,l;switch(null==(s=(t=this.props).onStateChange)||s.call(t,e),e.data){case A.PlayerState.ENDED:null==(i=(n=this.props).onEnd)||i.call(n,e);break;case A.PlayerState.PLAYING:null==(r=(o=this.props).onPlay)||r.call(o,e);break;case A.PlayerState.PAUSED:null==(l=(a=this.props).onPause)||l.call(a,e)}},this.onPlayerPlaybackRateChange=e=>{var t,s;return null==(s=(t=this.props).onPlaybackRateChange)?void 0:s.call(t,e)},this.onPlayerPlaybackQualityChange=e=>{var t,s;return null==(s=(t=this.props).onPlaybackQualityChange)?void 0:s.call(t,e)},this.destroyPlayer=()=>this.internalPlayer?(this.destroyPlayerPromise=this.internalPlayer.destroy().then((()=>this.destroyPlayerPromise=void 0)),this.destroyPlayerPromise):Promise.resolve(),this.createPlayer=()=>{if("undefined"==typeof document)return;if(this.destroyPlayerPromise)return void this.destroyPlayerPromise.then(this.createPlayer);const e=w(g({},this.props.opts),{videoId:this.props.videoId});this.internalPlayer=h()(this.container,e),this.internalPlayer.on("ready",this.onPlayerReady),this.internalPlayer.on("error",this.onPlayerError),this.internalPlayer.on("stateChange",this.onPlayerStateChange),this.internalPlayer.on("playbackRateChange",this.onPlayerPlaybackRateChange),this.internalPlayer.on("playbackQualityChange",this.onPlayerPlaybackQualityChange),(this.props.title||this.props.loading)&&this.internalPlayer.getIframe().then((e=>{this.props.title&&e.setAttribute("title",this.props.title),this.props.loading&&e.setAttribute("loading",this.props.loading)}))},this.resetPlayer=()=>this.destroyPlayer().then(this.createPlayer),this.updatePlayer=()=>{var e;null==(e=this.internalPlayer)||e.getIframe().then((e=>{this.props.id?e.setAttribute("id",this.props.id):e.removeAttribute("id"),this.props.iframeClassName?e.setAttribute("class",this.props.iframeClassName):e.removeAttribute("class"),this.props.opts&&this.props.opts.width?e.setAttribute("width",this.props.opts.width.toString()):e.removeAttribute("width"),this.props.opts&&this.props.opts.height?e.setAttribute("height",this.props.opts.height.toString()):e.removeAttribute("height"),this.props.title?e.setAttribute("title",this.props.title):e.setAttribute("title","YouTube video player"),this.props.loading?e.setAttribute("loading",this.props.loading):e.removeAttribute("loading")}))},this.getInternalPlayer=()=>this.internalPlayer,this.updateVideo=()=>{var e,t,s,n;if(void 0===this.props.videoId||null===this.props.videoId)return void(null==(e=this.internalPlayer)||e.stopVideo());let i=!1;const o={videoId:this.props.videoId};(null==(t=this.props.opts)?void 0:t.playerVars)&&(i=1===this.props.opts.playerVars.autoplay,"start"in this.props.opts.playerVars&&(o.startSeconds=this.props.opts.playerVars.start),"end"in this.props.opts.playerVars&&(o.endSeconds=this.props.opts.playerVars.end)),i?null==(s=this.internalPlayer)||s.loadVideoById(o):null==(n=this.internalPlayer)||n.cueVideoById(o)},this.refContainer=e=>{this.container=e},this.container=null,this.internalPlayer=null}componentDidMount(){this.createPlayer()}componentDidUpdate(e){return t=this,s=null,n=function*(){(function(e,t){var s,n,i,o;return e.id!==t.id||e.className!==t.className||(null==(s=e.opts)?void 0:s.width)!==(null==(n=t.opts)?void 0:n.width)||(null==(i=e.opts)?void 0:i.height)!==(null==(o=t.opts)?void 0:o.height)||e.iframeClassName!==t.iframeClassName||e.title!==t.title})(e,this.props)&&this.updatePlayer(),function(e,t){return e.videoId!==t.videoId||!l()(x(e.opts),x(t.opts))}(e,this.props)&&(yield this.resetPlayer()),function(e,t){var s,n;if(e.videoId!==t.videoId)return!0;const i=(null==(s=e.opts)?void 0:s.playerVars)||{},o=(null==(n=t.opts)?void 0:n.playerVars)||{};return i.start!==o.start||i.end!==o.end}(e,this.props)&&this.updateVideo()},new Promise(((e,i)=>{var o=e=>{try{a(n.next(e))}catch(e){i(e)}},r=e=>{try{a(n.throw(e))}catch(e){i(e)}},a=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,r);a((n=n.apply(t,s)).next())}));var t,s,n}componentWillUnmount(){this.destroyPlayer()}render(){return r().createElement("div",{className:this.props.className,style:this.props.style},r().createElement("div",{id:this.props.id,className:this.props.iframeClassName,ref:this.refContainer}))}},E=A;E.propTypes=b,E.defaultProps={videoId:"",id:"",className:"",iframeClassName:"",style:{},title:"",loading:void 0,opts:{},onReady:()=>{},onError:()=>{},onPlay:()=>{},onPause:()=>{},onEnd:()=>{},onStateChange:()=>{},onPlaybackRateChange:()=>{},onPlaybackQualityChange:()=>{}},E.PlayerState={UNSTARTED:-1,ENDED:0,PLAYING:1,PAUSED:2,BUFFERING:3,CUED:5};var T=E},4904:e=>{"use strict";var t;t=function(){var e={},t={};return e.on=function(e,s){var n={name:e,handler:s};return t[e]=t[e]||[],t[e].unshift(n),n},e.off=function(e){var s=t[e.name].indexOf(e);-1!==s&&t[e.name].splice(s,1)},e.trigger=function(e,s){var n,i=t[e];if(i)for(n=i.length;n--;)i[n].handler(s)},e},e.exports=t},5200:function(e){e.exports=function(){"use strict";var e=function e(){var t=0,s=document.createElement("div");function n(e){return s.appendChild(e.dom),e}function i(e){for(var n=0;n<s.children.length;n++)s.children[n].style.display=n===e?"block":"none";t=e}s.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",s.addEventListener("click",(function(e){e.preventDefault(),i(++t%s.children.length)}),!1);var o=(performance||Date).now(),r=o,a=0,l=n(new e.Panel("FPS","#0ff","#002")),c=n(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=n(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:s,addPanel:n,showPanel:i,begin:function(){o=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-o,200),r+1e3<=e&&(l.update(1e3*a/(e-r),100),r=e,a=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:s,setMode:i}};return e.Panel=function(e,t,s){var n=1/0,i=0,o=Math.round,r=o(window.devicePixelRatio||1),a=80*r,l=48*r,c=3*r,h=2*r,u=3*r,d=15*r,p=74*r,f=30*r,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var y=m.getContext("2d");return y.font="bold "+9*r+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=s,y.fillRect(0,0,a,l),y.fillStyle=t,y.fillText(e,c,h),y.fillRect(u,d,p,f),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(u,d,p,f),{dom:m,update:function(l,v){n=Math.min(n,l),i=Math.max(i,l),y.fillStyle=s,y.globalAlpha=1,y.fillRect(0,0,a,d),y.fillStyle=t,y.fillText(o(l)+" "+e+" ("+o(n)+"-"+o(i)+")",c,h),y.drawImage(m,u+r,d,p-r,f,u,d,p-r,f),y.fillRect(u+p-r,d,r,f),y.fillStyle=s,y.globalAlpha=.9,y.fillRect(u+p-r,d,r,o((1-l/v)*f))}}},e}()},4543:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=s(6764),o=(n=i)&&n.__esModule?n:{default:n};t.default={pauseVideo:{acceptableStates:[o.default.ENDED,o.default.PAUSED],stateChangeRequired:!1},playVideo:{acceptableStates:[o.default.ENDED,o.default.PLAYING],stateChangeRequired:!1},seekTo:{acceptableStates:[o.default.ENDED,o.default.PLAYING,o.default.PAUSED],stateChangeRequired:!0,timeout:3e3}},e.exports=t.default},5504:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(s(2849)),i=a(s(6287)),o=a(s(9970)),r=a(s(4543));function a(e){return e&&e.__esModule?e:{default:e}}var l=(0,n.default)("youtube-player"),c={proxyEvents:function(e){var t={},s=function(s){var n="on"+s.slice(0,1).toUpperCase()+s.slice(1);t[n]=function(t){l('event "%s"',n,t),e.trigger(s,t)}},n=!0,i=!1,r=void 0;try{for(var a,c=o.default[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){s(a.value)}}catch(e){i=!0,r=e}finally{try{!n&&c.return&&c.return()}finally{if(i)throw r}}return t},promisifyPlayer:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s={},n=function(n){t&&r.default[n]?s[n]=function(){for(var t=arguments.length,s=Array(t),i=0;i<t;i++)s[i]=arguments[i];return e.then((function(e){var t=r.default[n],i=e.getPlayerState(),o=e[n].apply(e,s);return t.stateChangeRequired||Array.isArray(t.acceptableStates)&&-1===t.acceptableStates.indexOf(i)?new Promise((function(s){e.addEventListener("onStateChange",(function n(){var i=e.getPlayerState(),o=void 0;"number"==typeof t.timeout&&(o=setTimeout((function(){e.removeEventListener("onStateChange",n),s()}),t.timeout)),Array.isArray(t.acceptableStates)&&-1!==t.acceptableStates.indexOf(i)&&(e.removeEventListener("onStateChange",n),clearTimeout(o),s())}))})).then((function(){return o})):o}))}:s[n]=function(){for(var t=arguments.length,s=Array(t),i=0;i<t;i++)s[i]=arguments[i];return e.then((function(e){return e[n].apply(e,s)}))}},o=!0,a=!1,l=void 0;try{for(var c,h=i.default[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){n(c.value)}}catch(e){a=!0,l=e}finally{try{!o&&h.return&&h.return()}finally{if(a)throw l}}return s}};t.default=c,e.exports=t.default},6764:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={BUFFERING:3,ENDED:0,PAUSED:2,PLAYING:1,UNSTARTED:-1,VIDEO_CUED:5},e.exports=t.default},9970:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["ready","stateChange","playbackQualityChange","playbackRateChange","error","apiChange","volumeChange"],e.exports=t.default},6287:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["cueVideoById","loadVideoById","cueVideoByUrl","loadVideoByUrl","playVideo","pauseVideo","stopVideo","getVideoLoadedFraction","cuePlaylist","loadPlaylist","nextVideo","previousVideo","playVideoAt","setShuffle","setLoop","getPlaylist","getPlaylistIndex","setOption","mute","unMute","isMuted","setVolume","getVolume","seekTo","getPlayerState","getPlaybackRate","setPlaybackRate","getAvailablePlaybackRates","getPlaybackQuality","setPlaybackQuality","getAvailableQualityLevels","getCurrentTime","getDuration","removeEventListener","getVideoUrl","getVideoEmbedCode","getOptions","getOption","addEventListener","destroy","setSize","getIframe"],e.exports=t.default},2563:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=a(s(4904)),o=a(s(4623)),r=a(s(5504));function a(e){return e&&e.__esModule?e:{default:e}}var l=void 0;t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=(0,i.default)();if(l||(l=(0,o.default)(a)),t.events)throw new Error("Event handlers cannot be overwritten.");if("string"==typeof e&&!document.getElementById(e))throw new Error('Element "'+e+'" does not exist.');t.events=r.default.proxyEvents(a);var c=new Promise((function(s){"object"===(void 0===e?"undefined":n(e))&&e.playVideo instanceof Function?s(e):l.then((function(n){var i=new n.Player(e,t);return a.on("ready",(function(){s(i)})),null}))})),h=r.default.promisifyPlayer(c,s);return h.on=a.on,h.off=a.off,h},e.exports=t.default},4623:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=s(6160),o=(n=i)&&n.__esModule?n:{default:n};t.default=function(e){return new Promise((function(t){if(window.YT&&window.YT.Player&&window.YT.Player instanceof Function)t(window.YT);else{var s="http:"===window.location.protocol?"http:":"https:";(0,o.default)(s+"//www.youtube.com/iframe_api",(function(t){t&&e.trigger("error",t)}));var n=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=function(){n&&n(),t(window.YT)}}}))},e.exports=t.default},9623:(e,t,s)=>{"use strict";function n(e,t,s){if(!t.has(e))throw new TypeError("attempted to "+s+" private field on non-instance");return t.get(e)}s.d(t,{Z:()=>n})},5804:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(9623);function i(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,(0,n.Z)(e,t,"get"))}},5980:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var n=s(9623);function i(e,t,s){return function(e,t,s){if(t.set)t.set.call(e,s);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=s}}(e,(0,n.Z)(e,t,"set"),s),s}},195:(e,t,s)=>{"use strict";s.d(t,{E:()=>o});var n=s(4599);function i(e,t){if(t===n.WwZ)return e;if(t===n.z$h||t===n.UlW){let s=e.getIndex();if(null===s){const t=[],n=e.getAttribute("position");if(void 0===n)return e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}const i=s.count-2,o=[];if(t===n.z$h)for(let e=1;e<=i;e++)o.push(s.getX(0)),o.push(s.getX(e)),o.push(s.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(o.push(s.getX(e)),o.push(s.getX(e+1)),o.push(s.getX(e+2))):(o.push(s.getX(e+2)),o.push(s.getX(e+1)),o.push(s.getX(e)));o.length;const r=e.clone();return r.setIndex(o),r.clearGroups(),r}return e}class o extends n.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new u(e)})),this.register((function(e){return new w(e)})),this.register((function(e){return new x(e)})),this.register((function(e){return new b(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new y(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new v(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new A(e)})),this.register((function(e){return new E(e)}))}load(e,t,s,i){const o=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:n.Zp0.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new n.hH6(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(s){try{o.parse(s,r,(function(s){t(s),o.manager.itemEnd(e)}),a)}catch(e){a(e)}}),s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let i;const o={},r={},l=new TextDecoder;if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer){if(l.decode(new Uint8Array(e,0,4))===T){try{o[a.KHR_BINARY_GLTF]=new R(e)}catch(e){return void(n&&n(e))}i=JSON.parse(o[a.KHR_BINARY_GLTF].content)}else i=JSON.parse(l.decode(e))}else i=e;if(void 0===i.asset||i.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new J(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](h);r[t.name]=t,o[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],s=i.extensionsRequired||[];switch(t){case a.KHR_MATERIALS_UNLIT:o[t]=new c;break;case a.KHR_DRACO_MESH_COMPRESSION:o[t]=new P(i,this.dracoLoader);break;case a.KHR_TEXTURE_TRANSFORM:o[t]=new M;break;case a.KHR_MESH_QUANTIZATION:o[t]=new I;break;default:s.indexOf(t)>=0&&r[t]}}h.setExtensions(o),h.setPlugins(r),h.parse(s,n)}parseAsync(e,t){const s=this;return new Promise((function(n,i){s.parse(e,t,n,i)}))}}function r(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class l{constructor(e){this.parser=e,this.name=a.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const o=t.json,r=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let a;const l=new n.Ilk(16777215);void 0!==r.color&&l.setRGB(r.color[0],r.color[1],r.color[2],n.GUF);const c=void 0!==r.range?r.range:0;switch(r.type){case"directional":a=new n.Ox3(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new n.cek(l),a.distance=c;break;case"spot":a=new n.PMe(l),a.distance=c,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,a.angle=r.spot.outerConeAngle,a.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return a.position.set(0,0,0),a.decay=2,W(a,r),void 0!==r.intensity&&(a.intensity=r.intensity),a.name=t.createUniqueName(r.name||"light_"+e),i=Promise.resolve(a),t.cache.add(s,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,n=s.json.nodes[e],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return s._getNodeRef(t.cache,i,e)}))}}class c{constructor(){this.name=a.KHR_MATERIALS_UNLIT}getMaterialType(){return n.vBJ}extendParams(e,t,s){const i=[];e.color=new n.Ilk(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const t=o.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],n.GUF),e.opacity=t[3]}void 0!==o.baseColorTexture&&i.push(s.assignTexture(e,"map",o.baseColorTexture,n.KI_))}return Promise.all(i)}}class h{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class u{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&o.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&o.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(o.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new n.FM8(e,e)}return Promise.all(o)}}class d{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return void 0!==o.iridescenceFactor&&(t.iridescence=o.iridescenceFactor),void 0!==o.iridescenceTexture&&i.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),void 0!==o.iridescenceIor&&(t.iridescenceIOR=o.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==o.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),void 0!==o.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),void 0!==o.iridescenceThicknessTexture&&i.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(i)}}class p{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new n.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];if(void 0!==r.sheenColorFactor){const e=r.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],n.GUF)}return void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&o.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,n.KI_)),void 0!==r.sheenRoughnessTexture&&o.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(o)}}class f{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return void 0!==o.transmissionFactor&&(t.transmission=o.transmissionFactor),void 0!==o.transmissionTexture&&i.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(i)}}class m{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&o.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=(new n.Ilk).setRGB(a[0],a[1],a[2],n.GUF),Promise.all(o)}}class y{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class v{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const o=[],r=i.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&o.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=(new n.Ilk).setRGB(a[0],a[1],a[2],n.GUF),void 0!==r.specularColorTexture&&o.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,n.KI_)),Promise.all(o)}}class g{constructor(e){this.parser=e,this.name=a.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?n.EJi:null}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];return void 0!==o.anisotropyStrength&&(t.anisotropy=o.anisotropyStrength),void 0!==o.anisotropyRotation&&(t.anisotropyRotation=o.anisotropyRotation),void 0!==o.anisotropyTexture&&i.push(s.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(i)}}class w{constructor(e){this.parser=e,this.name=a.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,o)}}class x{constructor(e){this.parser=e,this.name=a.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],r=n.images[o.source];let a=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return s.loadTextureImage(e,o.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class b{constructor(e){this.parser=e,this.name=a.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const o=i.extensions[t],r=n.images[o.source];let a=s.textureLoader;if(r.uri){const e=s.options.manager.getHandler(r.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return s.loadTextureImage(e,o.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class A{constructor(e){this.name=a.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const e=s.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const s=e.byteOffset||0,n=e.byteLength||0,o=e.count,r=e.byteStride,a=new Uint8Array(t,s,n);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(o,r,a,e.mode,e.filter).then((function(e){return e.buffer})):i.ready.then((function(){const t=new ArrayBuffer(o*r);return i.decodeGltfBuffer(new Uint8Array(t),o,r,a,e.mode,e.filter),t}))}))}return null}}class E{constructor(e){this.name=a.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;const i=t.meshes[s.mesh];for(const e of i.primitives)if(e.mode!==L.TRIANGLES&&e.mode!==L.TRIANGLE_STRIP&&e.mode!==L.TRIANGLE_FAN&&void 0!==e.mode)return null;const o=s.extensions[this.name].attributes,r=[],a={};for(const e in o)r.push(this.parser.getDependency("accessor",o[e]).then((t=>(a[e]=t,a[e]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then((e=>{const t=e.pop(),s=t.isGroup?t.children:[t],i=e[0].count,o=[];for(const e of s){const t=new n.yGw,s=new n.Pa4,r=new n._fP,l=new n.Pa4(1,1,1),c=new n.SPe(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&s.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&r.fromBufferAttribute(a.ROTATION,e),a.SCALE&&l.fromBufferAttribute(a.SCALE,e),c.setMatrixAt(e,t.compose(s,r,l));for(const t in a)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);n.Tme.prototype.copy.call(c,e),this.parser.assignFinalMaterial(c),o.push(c)}return t.isGroup?(t.clear(),t.add(...o),t):o[0]})))}}const T="glTF",C=1313821514,S=5130562;class R{constructor(e){this.name=a.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==T)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(e,12);let o=0;for(;o<n;){const t=i.getUint32(o,!0);o+=4;const n=i.getUint32(o,!0);if(o+=4,n===C){const n=new Uint8Array(e,12+o,t);this.content=s.decode(n)}else if(n===S){const s=12+o;this.body=e.slice(s,s+t)}o+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class P{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=a.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,r={},a={},l={};for(const e in o){const t=j[e]||e.toLowerCase();r[t]=o[e]}for(const t in e.attributes){const n=j[t]||t.toLowerCase();if(void 0!==o[t]){const i=s.accessors[e.attributes[t]],o=_[i.componentType];l[n]=o.name,a[n]=!0===i.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const s=e.attributes[t],n=a[t];void 0!==n&&(s.normalized=n)}t(e)}),r,l)}))}))}}class M{constructor(){this.name=a.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class I{constructor(){this.name=a.KHR_MESH_QUANTIZATION}}class F extends n._C8{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let e=0;e!==n;e++)t[e]=s[i+e];return t}interpolate_(e,t,s,n){const i=this.resultBuffer,o=this.sampleValues,r=this.valueSize,a=2*r,l=3*r,c=n-t,h=(s-t)/c,u=h*h,d=u*h,p=e*l,f=p-l,m=-2*d+3*u,y=d-u,v=1-m,g=y-u+h;for(let e=0;e!==r;e++){const t=o[f+e+r],s=o[f+e+a]*c,n=o[p+e+r],l=o[p+e]*c;i[e]=v*t+g*s+m*n+y*l}return i}}const N=new n._fP;class B extends F{interpolate_(e,t,s,n){const i=super.interpolate_(e,t,s,n);return N.fromArray(i).normalize().toArray(i),i}}const L={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},z={9728:n.TyD,9729:n.wem,9984:n.YLQ,9985:n.qyh,9986:n.aH4,9987:n.D1R},O={33071:n.uWy,33648:n.OoA,10497:n.rpg},k={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},j={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},q={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},H={CUBICSPLINE:void 0,LINEAR:n.NMF,STEP:n.Syv},D="OPAQUE",V="MASK",U="BLEND";function G(e,t,s){for(const n in s.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=s.extensions[n])}function W(e,t){void 0!==t.extras&&"object"==typeof t.extras&&Object.assign(e.userData,t.extras)}function K(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,n=t.weights.length;s<n;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,n=s.length;t<n;t++)e.morphTargetDictionary[s[t]]=t}}}function X(e){let t;const s=e.extensions&&e.extensions[a.KHR_DRACO_MESH_COMPRESSION];if(t=s?"draco:"+s.bufferView+":"+s.indices+":"+Y(s.attributes):e.indices+":"+Y(e.attributes)+":"+e.mode,void 0!==e.targets)for(let s=0,n=e.targets.length;s<n;s++)t+=":"+Y(e.targets[s]);return t}function Y(e){let t="";const s=Object.keys(e).sort();for(let n=0,i=s.length;n<i;n++)t+=s[n]+":"+e[s[n]]+";";return t}function Z(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Q=new n.yGw;class J{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new r,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,i=!1,o=-1;"undefined"!=typeof navigator&&(s=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,o=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||s||i&&o<98?this.textureLoader=new n.dpR(this.options.manager):this.textureLoader=new n.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new n.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])})).then((function(t){const o={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:s,userData:{}};return G(i,o,n),W(o,n),Promise.all(s._invokeAll((function(e){return e.afterRoot&&e.afterRoot(o)}))).then((function(){e(o)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let s=0,n=t.length;s<n;s++){const n=t[s].joints;for(let t=0,s=n.length;t<s;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(s[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),i=(e,t)=>{const s=this.associations.get(e);null!=s&&this.associations.set(t,s);for(const[s,n]of e.children.entries())i(n,t.children[s])};return i(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne((function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)})),!n)throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return s.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(e,o){s.load(n.Zp0.resolveURL(t.uri,i.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const s=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+s)}))}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){const e=k[i.type],t=_[i.componentType],s=!0===i.normalized,o=new t(i.count*e);return Promise.resolve(new n.TlE(o,e,s))}const o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then((function(e){const o=e[0],r=k[i.type],a=_[i.componentType],l=a.BYTES_PER_ELEMENT,c=l*r,h=i.byteOffset||0,u=void 0!==i.bufferView?s.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;let p,f;if(u&&u!==c){const e=Math.floor(h/u),s="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count;let c=t.cache.get(s);c||(p=new a(o,e*u,i.count*u/l),c=new n.vpT(p,u/l),t.cache.add(s,c)),f=new n.kB5(c,r,h%u/l,d)}else p=null===o?new a(i.count*r):new a(o,h,i.count*r),f=new n.TlE(p,r,d);if(void 0!==i.sparse){const t=k.SCALAR,s=_[i.sparse.indices.componentType],l=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,h=new s(e[1],l,i.sparse.count*t),u=new a(e[2],c,i.sparse.count*r);null!==o&&(f=new n.TlE(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=h.length;e<t;e++){const t=h[e];if(f.setX(t,u[e*r]),r>=2&&f.setY(t,u[e*r+1]),r>=3&&f.setZ(t,u[e*r+2]),r>=4&&f.setW(t,u[e*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,s=this.options,n=t.textures[e].source,i=t.images[n];let o=this.textureLoader;if(i.uri){const e=s.manager.getHandler(i.uri);null!==e&&(o=e)}return this.loadTextureImage(e,n,o)}loadTextureImage(e,t,s){const i=this,o=this.json,r=o.textures[e],a=o.images[t],l=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,s).then((function(t){t.flipY=!1,t.name=r.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const s=(o.samplers||{})[r.sampler]||{};return t.magFilter=z[s.magFilter]||n.wem,t.minFilter=z[s.minFilter]||n.D1R,t.wrapS=O[s.wrapS]||n.rpg,t.wrapT=O[s.wrapT]||n.rpg,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[l]=c,c}loadImageSource(e,t){const s=this,i=this.json,o=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const r=i.images[e],a=self.URL||self.webkitURL;let l=r.uri||"",c=!1;if(void 0!==r.bufferView)l=s.getDependency("bufferView",r.bufferView).then((function(e){c=!0;const t=new Blob([e],{type:r.mimeType});return l=a.createObjectURL(t),l}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then((function(e){return new Promise((function(s,i){let r=s;!0===t.isImageBitmapLoader&&(r=function(e){const t=new n.xEZ(e);t.needsUpdate=!0,s(t)}),t.load(n.Zp0.resolveURL(e,o.path),r,void 0,i)}))})).then((function(e){var t;return!0===c&&a.revokeObjectURL(l),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e})).catch((function(e){throw e}));return this.sourceCache[e]=h,h}assignTexture(e,t,s,n){const i=this;return this.getDependency("texture",s.index).then((function(o){if(!o)return null;if(void 0!==s.texCoord&&s.texCoord>0&&((o=o.clone()).channel=s.texCoord),i.extensions[a.KHR_TEXTURE_TRANSFORM]){const e=void 0!==s.extensions?s.extensions[a.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(o);o=i.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(o,e),i.associations.set(o,t)}}return void 0!==n&&(o.colorSpace=n),e[t]=o,o}))}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=void 0===t.attributes.tangent,o=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new n.UY4,n.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){const e="LineBasicMaterial:"+s.uuid;let t=this.cache.get(e);t||(t=new n.nls,n.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,this.cache.add(e,t)),s=t}if(i||o||r){let e="ClonedMaterial:"+s.uuid+":";i&&(e+="derivative-tangents:"),o&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),o&&(t.vertexColors=!0),r&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return n.Wid}loadMaterial(e){const t=this,s=this.json,i=this.extensions,o=s.materials[e];let r;const l={},c=[];if((o.extensions||{})[a.KHR_MATERIALS_UNLIT]){const e=i[a.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),c.push(e.extendParams(l,o,t))}else{const s=o.pbrMetallicRoughness||{};if(l.color=new n.Ilk(1,1,1),l.opacity=1,Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;l.color.setRGB(e[0],e[1],e[2],n.GUF),l.opacity=e[3]}void 0!==s.baseColorTexture&&c.push(t.assignTexture(l,"map",s.baseColorTexture,n.KI_)),l.metalness=void 0!==s.metallicFactor?s.metallicFactor:1,l.roughness=void 0!==s.roughnessFactor?s.roughnessFactor:1,void 0!==s.metallicRoughnessTexture&&(c.push(t.assignTexture(l,"metalnessMap",s.metallicRoughnessTexture)),c.push(t.assignTexture(l,"roughnessMap",s.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===o.doubleSided&&(l.side=n.ehD);const h=o.alphaMode||D;if(h===U?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,h===V&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&r!==n.vBJ&&(c.push(t.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new n.FM8(1,1),void 0!==o.normalTexture.scale)){const e=o.normalTexture.scale;l.normalScale.set(e,e)}if(void 0!==o.occlusionTexture&&r!==n.vBJ&&(c.push(t.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&r!==n.vBJ){const e=o.emissiveFactor;l.emissive=(new n.Ilk).setRGB(e[0],e[1],e[2],n.GUF)}return void 0!==o.emissiveTexture&&r!==n.vBJ&&c.push(t.assignTexture(l,"emissiveMap",o.emissiveTexture,n.KI_)),Promise.all(c).then((function(){const s=new r(l);return o.name&&(s.name=o.name),W(s,o),t.associations.set(s,{materials:e}),o.extensions&&G(i,s,o),s}))}createUniqueName(e){const t=n.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function o(e){return s[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(s){return $(s,e,t)}))}const r=[];for(let s=0,l=e.length;s<l;s++){const l=e[s],c=X(l),h=i[c];if(h)r.push(h.promise);else{let e;e=l.extensions&&l.extensions[a.KHR_DRACO_MESH_COMPRESSION]?o(l):$(new n.u9r,l,t),i[c]={primitive:l,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,o=this.extensions,r=s.meshes[e],a=r.primitives,l=[];for(let e=0,t=a.length;e<t;e++){const t=void 0===a[e].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new n.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:n.Wl3})),c.DefaultMaterial):this.getDependency("material",a[e].material);l.push(t)}var c;return l.push(t.loadGeometries(a)),Promise.all(l).then((function(s){const l=s.slice(0,s.length-1),c=s[s.length-1],h=[];for(let s=0,u=c.length;s<u;s++){const u=c[s],d=a[s];let p;const f=l[s];if(d.mode===L.TRIANGLES||d.mode===L.TRIANGLE_STRIP||d.mode===L.TRIANGLE_FAN||void 0===d.mode)p=!0===r.isSkinnedMesh?new n.TUv(u,f):new n.Kj0(u,f),!0===p.isSkinnedMesh&&p.normalizeSkinWeights(),d.mode===L.TRIANGLE_STRIP?p.geometry=i(p.geometry,n.UlW):d.mode===L.TRIANGLE_FAN&&(p.geometry=i(p.geometry,n.z$h));else if(d.mode===L.LINES)p=new n.ejS(u,f);else if(d.mode===L.LINE_STRIP)p=new n.x12(u,f);else if(d.mode===L.LINE_LOOP)p=new n.blk(u,f);else{if(d.mode!==L.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);p=new n.woe(u,f)}Object.keys(p.geometry.morphAttributes).length>0&&K(p,r),p.name=t.createUniqueName(r.name||"mesh_"+e),W(p,r),d.extensions&&G(o,p,d),t.assignFinalMaterial(p),h.push(p)}for(let s=0,n=h.length;s<n;s++)t.associations.set(h[s],{meshes:e,primitives:s});if(1===h.length)return r.extensions&&G(o,h[0],r),h[0];const u=new n.ZAu;r.extensions&&G(o,u,r),t.associations.set(u,{meshes:e});for(let e=0,t=h.length;e<t;e++)u.add(h[e]);return u}))}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(i)return"perspective"===s.type?t=new n.cPb(n.M8C.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===s.type&&(t=new n.iKG(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),W(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let e=0,n=t.joints.length;e<n;e++)s.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then((function(e){const t=e.pop(),s=e,i=[],o=[];for(let e=0,r=s.length;e<r;e++){const r=s[e];if(r){i.push(r);const s=new n.yGw;null!==t&&s.fromArray(t.array,16*e),o.push(s)}}return new n.OdW(i,o)}))}loadAnimation(e){const t=this.json,s=this,i=t.animations[e],o=i.name?i.name:"animation_"+e,r=[],a=[],l=[],c=[],h=[];for(let e=0,t=i.channels.length;e<t;e++){const t=i.channels[e],s=i.samplers[t.sampler],n=t.target,o=n.node,u=void 0!==i.parameters?i.parameters[s.input]:s.input,d=void 0!==i.parameters?i.parameters[s.output]:s.output;void 0!==n.node&&(r.push(this.getDependency("node",o)),a.push(this.getDependency("accessor",u)),l.push(this.getDependency("accessor",d)),c.push(s),h.push(n))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then((function(e){const t=e[0],i=e[1],r=e[2],a=e[3],l=e[4],c=[];for(let e=0,n=t.length;e<n;e++){const n=t[e],o=i[e],h=r[e],u=a[e],d=l[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();const p=s._createAnimationTracks(n,o,h,u,d);if(p)for(let e=0;e<p.length;e++)c.push(p[e])}return new n.m7l(o,void 0,c)}))}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return void 0===n.mesh?null:s.getDependency("mesh",n.mesh).then((function(e){const t=s._getNodeRef(s.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,s=n.weights.length;t<s;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this,s=this.json.nodes[e],n=t._loadNodeShallow(e),i=[],o=s.children||[];for(let e=0,s=o.length;e<s;e++)i.push(t.getDependency("node",o[e]));const r=void 0===s.skin?Promise.resolve(null):t.getDependency("skin",s.skin);return Promise.all([n,Promise.all(i),r]).then((function(e){const t=e[0],s=e[1],n=e[2];null!==n&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(n,Q)}));for(let e=0,n=s.length;e<n;e++)t.add(s[e]);return t}))}_loadNodeShallow(e){const t=this.json,s=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const o=t.nodes[e],r=o.name?i.createUniqueName(o.name):"",a=[],l=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return l&&a.push(l),void 0!==o.camera&&a.push(i.getDependency("camera",o.camera).then((function(e){return i._getNodeRef(i.cameraCache,o.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===o.isBone?new n.N$j:t.length>1?new n.ZAu:1===t.length?t[0]:new n.Tme,a!==t[0])for(let e=0,s=t.length;e<s;e++)a.add(t[e]);if(o.name&&(a.userData.name=o.name,a.name=r),W(a,o),o.extensions&&G(s,a,o),void 0!==o.matrix){const e=new n.yGw;e.fromArray(o.matrix),a.applyMatrix4(e)}else void 0!==o.translation&&a.position.fromArray(o.translation),void 0!==o.rotation&&a.quaternion.fromArray(o.rotation),void 0!==o.scale&&a.scale.fromArray(o.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],i=this,o=new n.ZAu;s.name&&(o.name=i.createUniqueName(s.name)),W(o,s),s.extensions&&G(t,o,s);const r=s.nodes||[],a=[];for(let e=0,t=r.length;e<t;e++)a.push(i.getDependency("node",r[e]));return Promise.all(a).then((function(e){for(let t=0,s=e.length;t<s;t++)o.add(e[t]);return i.associations=(e=>{const t=new Map;for(const[e,s]of i.associations)(e instanceof n.F5T||e instanceof n.xEZ)&&t.set(e,s);return e.traverse((e=>{const s=i.associations.get(e);null!=s&&t.set(e,s)})),t})(o),o}))}_createAnimationTracks(e,t,s,i,o){const r=[],a=e.name?e.name:e.uuid,l=[];let c;switch(q[o.path]===q.weights?e.traverse((function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)})):l.push(a),q[o.path]){case q.weights:c=n.dUE;break;case q.rotation:c=n.iLg;break;case q.position:case q.scale:c=n.yC1;break;default:if(1===s.itemSize)c=n.dUE;else c=n.yC1}const h=void 0!==i.interpolation?H[i.interpolation]:n.NMF,u=this._getArrayFromAccessor(s);for(let e=0,s=l.length;e<s;e++){const s=new c(l[e]+"."+q[o.path],t.array,u,h);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(s),r.push(s)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=Z(t.constructor),s=new Float32Array(t.length);for(let n=0,i=t.length;n<i;n++)s[n]=t[n]*e;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof n.iLg?B:F)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function $(e,t,s){const i=t.attributes,o=[];function r(t,n){return s.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in i){const s=j[t]||t.toLowerCase();s in e.attributes||o.push(r(i[t],s))}if(void 0!==t.indices&&!e.index){const n=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(n)}return n.epp.workingColorSpace,n.GUF,W(e,t),function(e,t,s){const i=t.attributes,o=new n.ZzF;if(void 0===i.POSITION)return;{const e=s.json.accessors[i.POSITION],t=e.min,r=e.max;if(void 0===t||void 0===r)return;if(o.set(new n.Pa4(t[0],t[1],t[2]),new n.Pa4(r[0],r[1],r[2])),e.normalized){const t=Z(_[e.componentType]);o.min.multiplyScalar(t),o.max.multiplyScalar(t)}}const r=t.targets;if(void 0!==r){const e=new n.Pa4,t=new n.Pa4;for(let n=0,i=r.length;n<i;n++){const i=r[n];if(void 0!==i.POSITION){const n=s.json.accessors[i.POSITION],o=n.min,r=n.max;if(void 0!==o&&void 0!==r){if(t.setX(Math.max(Math.abs(o[0]),Math.abs(r[0]))),t.setY(Math.max(Math.abs(o[1]),Math.abs(r[1]))),t.setZ(Math.max(Math.abs(o[2]),Math.abs(r[2]))),n.normalized){const e=Z(_[n.componentType]);t.multiplyScalar(e)}e.max(t)}}}o.expandByVector(e)}e.boundingBox=o;const a=new n.aLr;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=a}(e,t,s),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,s){let n=!1,i=!1,o=!1;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(void 0!==s.POSITION&&(n=!0),void 0!==s.NORMAL&&(i=!0),void 0!==s.COLOR_0&&(o=!0),n&&i&&o)break}if(!n&&!i&&!o)return Promise.resolve(e);const r=[],a=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(n){const t=void 0!==h.POSITION?s.getDependency("accessor",h.POSITION):e.attributes.position;r.push(t)}if(i){const t=void 0!==h.NORMAL?s.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(t)}if(o){const t=void 0!==h.COLOR_0?s.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l)]).then((function(t){const s=t[0],r=t[1],a=t[2];return n&&(e.morphAttributes.position=s),i&&(e.morphAttributes.normal=r),o&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,s):e}))}},7916:(e,t,s)=>{"use strict";s.d(t,{Id:()=>i});const n=Math.PI/180;Math.PI;function i(e){return e*n}}}]);